!function(t,e){"use strict";function i(t,e,i){t.prototype=new e,t.prototype.constructor=t;for(var n in i)"mixin"==n?_(t.prototype,i.mixin):"static"==n?_(t,i.static):t.prototype[n]=i[n]}function n(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i;for(var n in e)e.hasOwnProperty(n)&&"prototype"!==n&&(t[n]=e[n]);var n,o,s;for(n=2,o=arguments.length;o>n;n++)s=arguments[n],"function"==typeof s&&(s=s.prototype),_(t.prototype,s),s.mixin&&_(t.prototype,s.mixin),s.static&&_(t,s.static)}function o(){var t=arguments.length,e=arguments[0],i=arguments[t-1],o="function"==typeof i.initialize?i.initialize:function(){e.prototype.initialize&&e.prototype.initialize.apply(this,arguments)};if(t>1){var s=[o,e].concat(Array.prototype.slice.call(arguments).slice(1,t-1),i);n.apply(null,s)}else o.prototype=i;return o}function s(i,n,o){p[i]={object:t},v(n,function(){var t,r=i.split("."),a=e,h=r.length;for(t=0;h-1>t;t++)a=a[r[t]]=a[r[t]]||{};for(var c=[],u=n.length-1;u>=0;u--)c[u]=m(n[u]);if(p[i].object=a[r[t]]=o.apply(o,c),s in l){var d=l[i].callback;delete l[i],d()}})}function r(t,i,n){var s,r,a,h,c=t.split("."),l=e;for("string"==typeof i&&""!=i&&(s=u.require(i)),r=0,a=c.length-1;a>r;r++)l=l[c[r]]=l[c[r]]||{};arguments.length>1?(h=n||{},l[c[r]]="function"==typeof s?o(s,h):u.extend({},i)):l[c[r]]={}}function a(t,e,i,n){var s=n||{},r=u.require(e),a=o(r,s);u.module(t,i,a)}function h(t,e){u[t]=e}var c=e.P,u=function(t){return u.config(t)};"object"==typeof s&&"object"==typeof s.exports?s.exports=u:"function "==typeof define&&define.amd&&define(u),u.noConflict=function(){return e.P=c,this},u.version="20150928",e.P=u,u.global={};var l={},p=u.global;Date.now=Date.now||function(){return(new Date).valueOf()};var d={info:function(t){console.log("%cINFO : "+t,"color:#0080ff")},error:function(t){console.log("%cERROR : "+t,"color:red")},warn:function(t){console.log("%cWARN : "+t,"color:orange")},success:function(t){console.log("%cSUCCESS : "+t,"color:green")}},f=function(t){var e=t;return/^P\./.test(t)&&(e+=".js",u.MODULE_ROOT&&(e=u.MODULE_ROOT+"/"+e)),e},_=function(t){for(var e,i=Array.prototype.slice.call(arguments,1),n=t||{},o=0,s=i.length;s>o;o++)if(e=i[o]||{},"object"==typeof e)for(var r in e)n[r]=e[r];return n},v=function(t,e){if(t instanceof Array){var i=t.length;if(!i)return void e();var n=function(o){v(t[o],function(){o++,i>o?n(o):e()})};n(0)}else{if(null==t)return void e();if(p.hasOwnProperty(t))return void e();var o=m(t);if(o)return p[t]={object:o},void e();var s=f(t),r=document.createElement("script");r.setAttribute("src",s),document.getElementsByTagName("head")[0].appendChild(r),l[t]={name:t,src:s,callback:e}}},m=function(i){var n,o,s=i.split("."),r=e;for(n=0,o=s.length;o>n&&r!=t;n++)r=r[s[n]];return r},g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};u.factory=h,u.module=s,u.require=m,u.provide=r,u.extend=_,u.use=a,u.isArray=g,u.inherit=i,u.logger=d}(void 0,window),P.module("P.anim.Anim",[],function(){function t(t){var e=t.onUpdate,i=t.duration||Number.POSITIVE_INFINITY,n=t.onComplete,o=P.now(),s=function(){P.now()-o<=i?(e(),P.requestAnimationFrame(s)):(n&&n(),s=null)};P.requestAnimationFrame(s)}var e={inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return.5>t?e.inAndOut(2*t):1-e.inAndOut(2*(t-.5))}};return{loop:t,easing:e}}),P.module("P.anim.Timeline",["P.anim.Anim"],function(t){function e(t){this.pano=t,this.frameState=t._frameState,this.fn={},this.runing=!1,this.pano.frameSnapshot(),this.start=0,this.totalDuration=0,this.count=0}return e.prototype={wait:function(t){return this.totalDuration+=t,this},pan:function(t,e,i){return this.addTo({pan:{heading:t,pitch:e,duration:i}})},zoom:function(t,e){return this.addTo({zoom:{zoom:t,duration:e}})},bounce:function(t,e){return this.addTo({bounce:{zoom:t,duration:e}})},fly:function(t,e,i,n,o){var s={pan:{heading:t,pitch:e,duration:n}};return s[o===!0?"bounce":"zoom"]={zoom:i,duration:n},this.addTo(s)},creat:function(e,i,n,o){if("pan"==e){var s={type:"pan",start:o,duration:n,easing:"linear",easingFn:t.easing.linear,from:this.frameState.pan};return null!==i.heading&&(s.heading=i.heading),null!==i.pitch&&(s.pitch=i.pitch),s}return"zoom"==e?{type:"zoom",start:o,duration:n,zoom:i.zoom,easing:"linear",easingFn:t.easing.linear,from:this.frameState.zoom}:"bounce"==e?{type:"zoom",start:o,duration:n,zoom:i.zoom,easing:"upAndDown",easingFn:t.easing.upAndDown,from:this.frameState.zoom}:void 0},addTo:function(t){t=t||{};var e=0;0==this.runing&&(this.start=P.now(),this.totalDuration=0);var i=this.start+this.totalDuration;for(var n in t){var o=t[n],s=o.duration||1e3;e=Math.max(e,s),this.add(this.creat(n,o,s,i))}return this.totalDuration+=e,this},_step:function(e,i){var n=e.type;if(i.time<e.start)return i.animate=!0,i.process[n]=!0,e.from=i[n],!0;if(i.time<e.start+e.duration){i.animate=!0,i.process[n]=!0;var o="function"==typeof e.easing?e.easing:t.easing[e.easing],s=o((i.time-e.start)/e.duration);if("pan"==n){var r=e.heading-e.from[0],a=e.pitch-e.from[1];i.pan.heading=e.from[0]+s*r,i.pan.pitch=e.from[1]+s*a}else i[n]=e.from+s*(e[n]-e.from);return!0}return i.process[n]=!1,!1},inTimeline:function(){},update:function(){this.frameState.time=P.now();var t=!1;for(var e in this.fn){var i=this._step(this.fn[e],this.frameState);0==i&&this.remove(e),t=t||i}t?(this.frameState.process.pan&&this.pano.setPov(this.frameState.pan,!1,!1),this.frameState.process.zoom&&this.pano.setZoom(this.frameState.zoom,!1,!1,this.frameState.lookat),P.requestAnimationFrame(P.bind(this.update,this))):(this.pano.render(!0),this.timeline=null,this.runing=!1)},add:function(t){return this.fn[++this.count]=t,0==this.runing&&(this.pano.frameSnapshot(),P.requestAnimationFrame(P.bind(this.update,this)),this.runing=!0),this.count},remove:function(t){this.fn[t]&&delete this.fn[t],this.pano.frameSnapshot()},clear:function(){for(var t in this.fn)delete this.fn[t];this.pano.frameSnapshot()},has:function(t){return t in this.fn}},e}),P.module("P.base.code",[],function(){return{decode:function(t){var e,i,n,o,s=function(t){if(6==t.length)return"20"+t.substring(0,2)+"-"+t.substring(2,4)+"-"+t.substring(4,6);var e=t.substring(0,4),i=t.substring(4,6),n=t.substring(6,8),o=t.substring(8,10),s=t.substring(10,12);return e+"-"+i+"-"+n+" "+o+":"+s},r=function(t,e){var i=t.length;return e>i&&(t=new Array(e-i+1).join("0")+t),t},a=r(parseInt(t.substring(0,1)).toString(2),3),h=("0"==a.charAt(0)?!1:!0,"0"==a.charAt(1)?!1:!0),c="0"==a.charAt(2)?!1:!0;if(38==t.length){var u=r(parseInt(t.substring(1,2)).toString(2),3),l="",p="0"==u.charAt(0)?!1:!0,d="0"==u.charAt(1)?!1:!0;return e=(p?"bc ":"")+s(t.substring(2,14)),i=parseFloat(t.substring(14,22))/1e6,n=parseFloat(t.substring(22,31))/1e6,o=parseInt(t.substring(31,34)),h&&(i*=-1),c&&(n*=-1),d&&(l=t.substring(34,38)),{time:e,lat:i,lng:n,dir:o,copyright:l}}return 27==t.length?(e=s(t.substring(1,7)),i=parseFloat(t.substring(7,15))/1e6,n=parseFloat(t.substring(15,24))/1e6,o=parseInt(t.substring(24,27)),h&&(i*=-1),c&&(n*=-1),{time:e,lat:i,lng:n,dir:o,copyright:""}):void 0},encode:function(t,e){t=t||{};var i=function(t,e){var i=t.length;return e>i&&(t=new Array(e-i+1).join("0")+t),t},n=function(t){return 10>t?"0"+t:""+t},o=new Date(t.time.replace(/bc\s+/i,"")),s=o.getFullYear()+n(o.getMonth()+1)+n(o.getDate())+n(o.getHours())+n(o.getMinutes()),r=Math.floor(1e6*t.lat),a=Math.floor(1e6*t.lng),h=i(t.dir+"",3),c=(i(t.alt+"",4),t.ident||""),u=/bc/i.test(t.time)?1:0,l=0>r?1:0,p=0>a?1:0;r=i(""+Math.abs(r),8),a=i(""+Math.abs(a),9);var d=t.m===!0?0:1,f=void 0===t.ident?0:1,_=parseInt([d,l,p].join(""),2).toString(10),v=parseInt([u,f,0].join(""),2).toString(10);return e===!0?(s=s.substring(2,8),""+_+s+r+a+h):""+_+v+s+r+a+h+c}}}),P.module("P.base.feature",[],function(){var t=(navigator.platform.toLowerCase(),navigator.userAgent),e="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,i=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints&&!window.PointerEvent,n=window.PointerEvent&&window.navigator.pointerEnabled&&window.navigator.maxTouchPoints||i,o=document.documentElement,s="ActiveXObject"in window,r=s&&!document.addEventListener,a=t.indexOf("Android")>=0,h=-1!==t.search("android [23]"),c=parseInt((/WebKit\/([\d]+)/.exec(t)||0)[1],10)||0,u=s&&"transition"in o.style,l="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!h,p="MozPerspective"in o.style,d="OTransition"in o.style,f=u||l||p||d,_=typeof orientation!=void 0+"",v=n||"ontouchstart"in o,m=function(){for(var t,e=!0&&!!window.WebGLRenderingContext,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=document.createElement("canvas"),o=0;o<i.length;o++){try{t=n.getContext(i[o])}catch(s){}if(t){e=!0;break}}return null==t&&(e=!1),t=null,n=null,{support:e,prefix:o==i.length?null:i[o]}}();return{ie:s,ielt9:r,retina:e,msPointer:i,pointer:n,chrome:/chrome/.test(t),webkit:/webkit/.test(t),mobile:_,webgl:m.support,webglprefix:m.prefix,css3d:f,touch:v,webkitver:c,androidnative:a&&534>=c,canvas:!!document.createElement("canvas").getContext}}),P.module("P.base.dom",["P.base.feature"],function(t){var e={on:function(e,i,n,o){{var s,r=P.stamp(n),a="__pano_"+i+r;t.msTouch}if(s=function(i){return t.ielt9&&(i.target=i.srcElement),n.call(o||e,i)},"swipe"==i||"pinch"==i){return}return t.pointer&&0===i.indexOf("touch")?this.addPointerListener(e,i,s,r):(e.addEventListener?"mousewheel"===i?(e.addEventListener("DOMMouseScroll",s,!1),e.addEventListener(i,s,!1)):e.addEventListener(i,s,!1):e.attachEvent?e.attachEvent("on"+i,s):e["on"+i]=s,e[a]=s,this)},has:function(){},un:function(e,i,n){var o=P.stamp(n),s="__pano_"+i+o,r=e[s];return r?(t.pointer&&0===i.indexOf("touch")?this.removePointerListener(e,i,o):e.removeEventListener?"mousewheel"===i?(e.removeEventListener("DOMMouseScroll",r,!1),e.removeEventListener(i,r,!1)):e.removeEventListener(i,r,!1):e.detachEvent?e.detachEvent("on"+i,r):delete e["on"+i],delete e[s],this):this},trigger:function(t,e,i,n){var o="__pano_"+e+i,s=t[o];return s&&s(n),this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this},disableScroll:function(t){var i=e.stop;return P.Event.on(t,"mousewheel",i).on(t,"MozMousePixelScroll",i)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return e.preventDefault(t).stopPropagation(t)},getWheelDelta:function(t){return t.wheelDelta?t.wheelDelta/120:t.detail?t.detail/-3:0}};P.extend(e,{POINTER_DOWN:t.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:t.msPointer?"MSPointerMove":"pointermove",POINTER_UP:t.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:t.msPointer?"MSPointerCancel":"pointercancel",_touches:[],addPointerListener:function(t,e,i){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i);case"touchend":return this.addPointerListenerEnd(t,e,i);case"touchmove":return this.addPointerListenerMove(t,e,i);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,e,i){var n=this._touches,o="__pano_touchstart"+id,s=function(t){for(var e=!1,o=0,s=n.length;s>o;++o)if(n[o].pointerId==t.pointerId){e=!0;break}e||n.push(t),t.touches=n.slice(),i(t)};t[o]=s,t.addEventListener(this.POINTER_DOWN,s);t.addEventListener(this.POINTER_UP,s)},addPointerListenerMove:function(t,e,i,n){var o=this._touches,s="__pano_touchmove"+n,r=function(t){if((t.pointerType!=t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!=t.buttons)&&(1!=o.length||o[0].pageX!=t.pageX||o[0].pageY!=t.pageY)){for(var e=0,n=o.length;n>e;++e)if(o[e].pointerId==t.pointerId){o[e]=t;break}t.touches=o.slice(),i(t)}};return t[s]=r,t.addEventListener(this.POINTER_MOVE,r,!1),this},addPointerListenerEnd:function(t,e,i,n){var o=this._touches,s="__pano_touchend"+n,r=function(t){for(var e=0,n=o.length;n>e;++e)if(o[e].pointerId==t.pointerId){o.splice(e,1);break}t.touches=o.slice(),i(t)};el[s]=r,el.addEventListener(this.POINTER_UP,r,!1),el.addEventListener(this.POINTER_CANCEL,r,!1)},removePointerListener:function(t,e,i){var n=t["__pano_"+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,n,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,n,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,n,!1),t.removeEventListener(this.POINTER_CANCEL,n,!1)}return this}});var i=function(t){return document.querySelector(t)},n=function(t){return document.getElementById(t)},o=function(t,e,i){return void 0===i?t.getAttribute(e):void t.setAttribute(e,i)},s=function(t,e,i,n,o,s){var r=document.createElement(t);if(e&&(r.id=e),i&&(r.className=i),o&&r.setAttribute("style",o),s)for(var a in s)r.setAttribute(a,s[a]);return n&&n.appendChild(r),r},r=function(){var t="khtml ms o moz webkit".split(" "),e=t.length,i=!1;if(void 0!=document.cancelFullScreen)i=!0;else for(var n=0;e>n;n++){var o=t[n];if(void 0!=document[o+"CancelFullScreen"]){i=!0;break}}return{vendor:o,support:i,requestFullScreen:function(t){return""===this.vendor?t.requestFullScreen():t[this.vendor+"RequestFullScreen"]()},cancelFullScreen:function(){return""===this.vendor?document.cancelFullScreen():document[this.vendor+"CancelFullScreen"]()},isFullScreen:function(){return 1==(document.fullScreen||document.webkitIsFullScreen||document[this.vendor+"FullScreen"])}}}(),a=function(){return P.point(0,0)},h=function(t,e){if("object"!=typeof e)return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle?t.currentStyle[e]:void 0;for(var i in e)t.style[i]=e[i]},c=function(t){var e=t.getBoundingClientRect();return e.right-e.left},u=function(t){var e=t.getBoundingClientRect();return e.bottom-e.top},l=function(t,e){return t.classList?/\s/.test(e)?!1:t.classList.contains(e):new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)},p=function(t,e){l(t,e)||(t.classList?t.classList.add.apply(t.classList,e.split(" ")):t.className+=" "+e)},d=function(t,e){if(l(t,e))if(t.classList)t.classList.remove(e);else{for(var i=t.className.split(/\s+/),n=i.length-1;n>=0;n--)i[n]==e&&i.splice(n,1);t.className=i.join(" ")}},f=function(t,e){l(t,e)?d(t,e):p(t,e)};return P.full=r,P.creat=s,P.css=h,P.width=c,P.height=u,P.$=n,P.data=o,P.event=e,P.on=e.on,P.un=e.un,{$:n,query:i,event:e,data:o,creat:s,full:r,css:h,width:c,height:u,addClass:p,removeClass:d,toggleClass:f,getPosition:a,on:e.on,un:e.un}}),P.module("P.base.events",[],function(){return{listeners:{},on:function(t,e){for(var i in t)this.addEventListener(i,t[i],e);return this},un:function(t){for(var e in t)this.removeEventListener(e,t[e]);return this},addEventListener:function(t,e,i){var n=this.listeners[t];n||(n=[],this.listeners[t]=n);var o={instance:this,type:t,handler:e,scope:i||this};return n.push(o),this},removeEventListener:function(t,e){var i=this.listeners[t];if(null!=i)for(var n=0,o=i.length;o>n;n++)if(i[n].handler==e){i.splice(n,1);break}return this},clearEventListeners:function(t){var e=this.listeners[t];if(null!=e){for(var i=0,n=e.length;n>i;i++)this.removeEventListener(t,e[i].handler);this.listeners[t]=[]}return this},trigger:function(t,e){var i,n=this.listeners[t];if(!n||0==n.length)return this;e=e||{},e.target=this,e.type||(e.type=t),n=n.slice();for(var o=0,s=n.length;s>o;o++){var r=n[o];i=r.handler.call(r.scope,e)}return this}}}),P.module("P.base.http",[],function(){function thread(t,e,i){this.free=!0,this.data=null,this.content=new Image,this.retry=3,this.id="",this.fn=P.bind(t,e,this),this.error=P.bind(i,e,this),this.url="",this.start=function(t){this.free=!1,this.retry=3,this.data=t,this.id=t.id,this.content.src=this.url=t.url},this.onerror=function(){--this.retry?this.content.src=this.content.src:this.error(this)},this.init=function(){this.content.onload=this.fn,this.content.onerror=P.bind(this.onerror,this)},this.init()}function _request(o){this.url=o.url||"",this.success=o.success||null,this.error=o.error||null,this.async=o.async||!0,this.time=o.timeout||3e3,this.type=o.type||"GET",this.dataType=o.dataType||"",this.data=o.data||"";var self=this;if(""!=this.url){if(window.XMLHttpRequest)this._request=new XMLHttpRequest;else try{this._request=new ActiveXObject("Microsoft.XMLHTTP")||new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return void alert("init error...")}var timer=setTimeout(function(){return"function"==typeof self.error&&self.error("timeout"),self._request&&(self._request.abort(),self._request=null),!0},this.time);this._request.open(this.type,this.url,this.async),"POST"==this.type&&this._request.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded"),this._request.send(this.data),this._request.onreadystatechange=function(){if(4==self._request.readyState&&200==self._request.status){var req=self._request,ct=req.getResponseHeader("content-type"),res=!dataType&&ct&&ct.indexOf("xml")>=0,dataType=self.dataType.toUpperCase();res="XML"==dataType||res?req.responseXML:req.responseText,"SCRIPT"==dataType?res=eval(req.responseText):"JSON"==dataType&&(res=eval("("+req.responseText+");")),200==self._request.status&&(timer&&clearTimeout(timer),"function"==typeof self.success&&self.success.call(this,res))}}}}function ajax(t){return new _request(t)}var LoaderQueue=function(t){t=t||{},this.thread=t.thread||5,this.onUpdate=t.onUpdate,this.onComplete=t.onComplete,this.instances=[];for(var e=this.thread;e--;)this.instances[e]=new thread(this._next,this,this._error);this.task=[],this.free=!0,this.status=0};LoaderQueue.prototype={add:function(t){this.task=t,this.status=1,this._check()._start()},find:function(t){for(var e=this.task.length;e--;)if(this.task[e].url==t)return e;return-1},_check:function(){var t,e;for(e=this.instances.length;e--;)this.instances[e].free!==!0&&(t=this.find(this.instances[e].url),t>=0&&(this.task[t].loading=!0));return this},remove:function(){},clear:function(){for(var t in this.task);this.task=[],this.status=0},_start:function(){this.free=!1;for(var t=this.instances.length;t--;)if(this.instances[t].free){var e=this.setTask(this.instances[t]);if(-1==e)return this}return this},setTask:function(t){for(var e=0,i=this.task.length;i>e;e++){var n=this.task[e];if(n.loading!==!0)return n.loading=!0,t.start(n),e}return-1},_error:function(t){var e=this.find(t.url);-1!=e&&this.task.splice(e,1),task.free=!0},_next:function(t){var e=this.find(t.url);e>=0&&(this.task.splice(e,1),this.onUpdate(t.data,t.content)),t.free=!0,-1==this.setTask(t)&&(this.free=!0,this.status=0,this.onComplete&&this.onComplete())}};var jsonp=function(t,e){var i="jsonp_callback_"+(new Date).getTime();P[i]=function(t){delete P[i],document.body.removeChild(n),e(t)};var n=document.createElement("script");n.src=t.replace("=?","=P."+i),document.body.appendChild(n)};return P.jsonp=jsonp,P.ajax=ajax,{ajax:ajax,jsonp:jsonp,LoaderQueue:LoaderQueue}}),P.module("P.base.kinetic",[],function(){function t(t,e,i){this.decay_=t||-.008,this.minVelocity_=e||.01,this.delay_=i||200,this.points_=[],this.angle_=0,this.initialVelocity_=0}t.prototype={begin:function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},update:function(t,e){this.points_.push(t,e,P.now())},end:function(){if(this.points_.length<6)return!1;var t=P.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;i>0&&this.points_[i+2]>t;)i-=3;var n=this.points_[e+2]-this.points_[i+2],o=this.points_[e]-this.points_[i],s=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/n,this.initialVelocity_>this.minVelocity_},pan:function(t,e){var i=this.decay_,n=this.initialVelocity_,o=this.minVelocity_-n,s=this.getDuration_(),r=function(t){return n*(Math.exp(i*t*s)-1)/o};return{type:"pan",heading:e[0],pitch:e[1],from:t,duration:s,easing:r,start:P.now()}},getDuration_:function(){return Math.log(this.minVelocity_/this.initialVelocity_)/this.decay_},getDistance:function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},getAngle:function(){return this.angle_}};return t}),P.module("P.base.utils",["P.base.feature"],function(t){function e(t,e){return e||(e=12),e*t.replace(/[^\x00-\xff]/g,"ci").length}function i(t){return t[r]=t[r]||++s}console.log("load : base.utils");var n,o={down:t.touch?"touchstart":"click"},s=0,r="__panoId__",a=Date.now||function(){return(new Date).getTime()},h=function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):[];return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=window.getComputedStyle?window.getComputedStyle(document.documentElement,""):document.documentElement.style;document.body.currentStyle&&(n={dom:"MS",lowercase:"ms",css:"-ms-",js:"Ms"});var l=(Array.prototype.slice.call(u).join("").match(/-(moz|webkit|ms)-/)||""===u.OLink&&["","o"])[1],p="WebKit|Moz|MS|O".match(new RegExp("("+l+")","i"))[1];n={dom:p,lowercase:l,css:"-"+l+"-",js:l[0].toUpperCase()+l.substr(1)};var d,f=function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,i){var n=e[i];return void 0===n?(console.log("No value provided for variable "+t),n="{"+i+"}"):"function"==typeof n&&(n=n(e)),n})},_=function(t){d&&(d.innerHTML=t+"<br />"+d.innerHTML,console.log(t))},v=function(t,e){return t.options=P.extend({},t.options,e),t.options},m=function(){function t(){P.css(s,{top:"50%",width:"120px",height:"35px"}),r.mini(!0)}function e(){P.css(s,{top:"80%",width:"100%",height:"20%"}),r.mini(!1)}function i(i){void 0===i&&(i="20%"==s.style.height?!1:!0),console.log(i),i?e():t()}function n(t,e){s=P.creat("div","pano-log",null,P.$(t),"display:block;border-radius: 2px;font-family:arial; text-align: left;position:fixed;top:80%;left:0;width:100%;height:20%;background: rgba(0,0,0,.85);color:#fff;border-top:#eee 1px solid;z-index:9999999;padding-top:35px;"),d=P.creat("div","pano-log",null,s,"padding-left:5px;position:absolute;height:100%;width:100%;overflow-y:auto;margin-top:35px;top:0;z-index:0;"),P.on(document,"keydown",function(t){79==t.keyCode&&i(),67==t.keyCode&&(d.innerHTML="")},this),r=w("tl",e,s),r.el.addEventListener(o.down,function(){i()})}var s,r;return function(t,e){n(t,e)}}(),g={EPSG4326To3785:function(t){return{lat:this.latFrom4326ToProj(t.lat),lng:this.lngFrom4326ToProj(t.lng)}},EPSG3785To4326:function(t){return{lat:this.latFromProjTo4326(t.lat),lng:this.lngFromProjTo4326(t.lng)}},lngFrom4326ToProj:function(t){return t=parseFloat(t),111319.49077777778*t},latFrom4326ToProj:function(t){return t=parseFloat(t),t=Math.log(Math.tan(.008726646259971648*(90+t)))/.017453292519943295,t*=111319.49077777778},lngFromProjTo4326:function(t){return t/111319.49077777778},latFromProjTo4326:function(t){return t/=111319.49077777778,t=114.59155902616465*Math.atan(Math.exp(.017453292519943295*t))-90}},y=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,16)};return function(e,i){t.apply(window,[e,i])}}(),b={looping:!1,objects:[],defaultOptions:{time:1,transition:"easeNone",delay:0,prefix:{},suffix:{},onStart:void 0,onStartParams:void 0,onUpdate:void 0,onUpdateParams:void 0,onComplete:void 0,onCompleteParams:void 0},inited:!1,easingFnLowerCase:{},init:function(){this.inited=!0;for(var t in b.easingFn)this.easingFnLowerCase[t.toLowerCase()]=b.easingFn[t]},toNumber:function(t,e,i){return i||(i="px"),t.toString().match(/[0-9]/)?Number(t.toString().replace(new RegExp(i+"$"),"").replace(new RegExp("^"+(e?e:"")),"")):0},to:function(t,e){var i=this;this.inited||this.init();var n={};n.target=t,n.targetPropeties={};for(var o in this.defaultOptions)"undefined"!=typeof e[o]?(n[o]=e[o],delete e[o]):n[o]=this.defaultOptions[o];n.easing="function"==typeof n.transition?n.transition:this.easingFnLowerCase[n.transition.toLowerCase()];for(var o in e){n.prefix[o]||(n.prefix[o]=""),n.suffix[o]||(n.suffix[o]="");var s=this.toNumber(t[o],n.prefix[o],n.suffix[o]);n.targetPropeties[o]={b:s,c:e[o]-s}}setTimeout(function(){n.startTime=new Date-0,n.endTime=1e3*n.time+n.startTime,"function"==typeof n.onStart&&(n.onStartParams?n.onStart.apply(n,n.onStartParams):n.onStart()),i.objects.push(n),i.looping||(i.looping=!0,i.eventLoop.call(i))},1e3*n.delay)},eventLoop:function(){for(var t=new Date-0,e=0;e<this.objects.length;e++){var i=this.objects[e],n=t-i.startTime,o=i.endTime-i.startTime;if(n>=o){for(var s in i.targetPropeties){var r=i.targetPropeties[s];try{i.target[s]=i.prefix[s]+(r.b+r.c)+i.suffix[s]}catch(a){}}this.objects.splice(e,1),"function"==typeof i.onUpdate&&(i.onUpdateParams?i.onUpdate.apply(i,i.onUpdateParams):i.onUpdate()),"function"==typeof i.onComplete&&(i.onCompleteParams?i.onComplete.apply(i,i.onCompleteParams):i.onComplete())}else{for(var s in i.targetPropeties){var r=i.targetPropeties[s],h=i.easing(n,r.b,r.c,o);try{i.target[s]=i.prefix[s]+h+i.suffix[s]}catch(a){}}"function"==typeof i.onUpdate&&(i.onUpdateParams?i.onUpdate.apply(i,i.onUpdateParams):i.onUpdate())}}if(this.objects.length>0){var c=this;P.requestAnimationFrame(function(){c.eventLoop()})}else this.looping=!1}};b.easingFn={easeNone:function(t,e,i,n){return i*t/n+e}},b.easingFn.linear=b.easingFn.easeNone;var w=function(){var t,e,i,n,o,s,r=0,a=9999,h=0,c=0,u=0,l=0,p=0,d=Math.floor,f=Math.abs,_=!1,v="full",m=function(){var _=(new Date).getTime();return u++,r=d(1e3/(_-t)),r>70?(t=_,void y(m)):(c=d(1e3*u/(_-e)),a>r&&(a=r),r>h&&(h=r),p+=f(r-c),l=d(100*p/u)/100,_-i>=1e3&&(o.innerHTML="full"==v?s+", "+n._scene._totalTiles+" tile(s)<br/>FPS: "+r+"(min/avg/max/md = "+a+"/"+c+"/"+h+"/"+l+") , "+n.getDeep():s+", "+n._scene._totalTiles+" tile(s)<br/>FPS: "+r,i=_),t=_,void y(m))},g=function(r,a,h){n=a,_=!0,r=r||"lc";for(var c={l:"left:0;",r:"right:0;",t:"top:0;",b:"bottom:0;",c:"top:42%;"},u="",l=r.length;l--;)c[r[l]]&&(u+=c[r[l]]);o=document.createElement("div"),o.setAttribute("style",u+"position:absolute;height:32px;color:#0f0;z-index:2;text-align: left;padding-left:2px;transform: translateZ(999999px);letter-spacing:1px;font-size:12px !important;"),s=a.options.render.toUpperCase()+"Render ( build:"+P.version+" ) ",h||(h=document.body),h.appendChild(o),t=e=i=(new Date).getTime(),y(m)},b=function(t){v=t?"mini":"full"};return function(t,e,i){return g(t,e,i),{el:o,mini:b}}}();return P.stamp=i,P.prefix=n,P.setOptions=v,P.bind=h,P.now=a,P.requestAnimationFrame=y,{getLength:e,stamp:i,now:a,bind:h,promise:null,isArray:c,prefix:n,template:f,setOptions:v,logger:_,tweener:b,requestFrame:y,proj:g,debug:m}}),P.module("P.base.services",["P.base.utils"],function(t){var e=function(e){var i=[];e=e.detail.scenes;for(var n=0;n<e.length;n++)i[n]={id:e[n].svid,title:e[n].name,link:[],pois:[],lat:t.proj.latFromProjTo4326(e[n].y),lng:t.proj.lngFromProjTo4326(e[n].x),dir:e[n].dir};return i},i=function(i,n){t.jsonp("http://sv.map.qq.com/photos?id="+i+"&output=jsonp&cb=?",function(t){n(e(t))})},n=function(t,i){P.jsonp("http://sv.map.qq.com/sv?pf=html5&svid="+t+"&ch=&output=jsonp&cb=?",function(t){function n(){var t=u+"-"+(p+1);P.jsonp("http://sv.map.qq.com/photos?id="+t+"&output=jsonp&cb=?",function(t){a[p].pano=e(t),p++,p<a.length?setTimeout(n,10):i({owner:o,provider:h,description:s,basic:r,scene:a})})}for(var o="Tencent SteetView",s=t.detail.basic.scenic_name,r={tileSize:256,level:1,type:"cube",onceMode:!0,ignoneLv0:!0},a=[],h={id:"Tencent",link:"http://map.qq.com",title:s},c=t.detail.building.floors,u=t.detail.building.group_id,l=0;l<c.length;l++)a[l]={id:u+"-"+(l+1),title:c[l].name,pano:[],sync:!1};var p=0;n()})},o=function(e){P.jsonp("http://sv0.map.qq.com/sv?pf=html5&svid="+e+"&ch=&output=jsonp&cb=?&token="+(new Date).getTime(),function(i){var n=parseInt(i.detail.basic.dir),o=i.detail.addr.y_lat,s=i.detail.addr.x_lng,r="20"+e.substring(8,10)+"-"+e.substring(10,12)+"-01";console.log({time:r,lat:o,lng:s,alt:0,dir:n}),console.log(t.code.encode({time:r,lat:o,lng:s,alt:0,dir:n},!0))})},s=function(t,e,i){var n="http://sv.map.qq.com/rarp?lat="+t.lat+"&lng="+t.lng+"&output=jsonp&cb=?";i&&(n="http://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&location="+t.lat+","+t.lng+"&key="+i+"&get_poi=0&cb=?"),P.jsonp(n,function(t){var n="";void 0==i?0==t.info.errno&&(n=t.detail.AD):0==t.status&&(n=t.result.address),e(n)})},r=function(t,e){P.jsonp("http://routes.map.qq.com/?qt=rich&pid="+t+"&output=jsonp&cb=?",function(t){for(var i=[],n=t.detail.comments.comment_info,o=0;o<n.length;o++){var s=n[o];i[o]={review_id:(s.comment_detail_url.match(/review\/(\d+)/)||[0,-1])[1],user_nickname:s.comment_user,created_time:s.comment_time,text_excerpt:s.comment_content,rating_img_url:"http://i3.dpfile.com/s/i/app/api/32_0star.png",rating_s_img_url:"http://i2.dpfile.com/s/i/app/api/16_0star.png",product_rating:3,decoration_rating:4,service_rating:3,review_url:s.comment_detail_url}}var r={status:"OK",count:t.detail.comments.comment_num,reviews:i,additional_info:{more_reviews_url:t.detail.comments.rich_source_url}};e&&e(r)})};return{getQQScene:i,getQQData:n,QQ2HQT:o,geoCoder:s,getCommentFromQQ:r}}),P.module("P.base.ua",[],function(){var t=navigator.platform.toLowerCase(),e=navigator.userAgent.toLowerCase(),i=/win/.test(t)?"windows":/mac/.test(t)?"mac":/ios/.test(t)?"ios":/android/.test(e)&&/linux/.test(t)?"android":/linux/.test(t)?"linux":"",n=/chrome/.test(e)?"chrome":/webKit/.test(e)&&!/chrome/.test(e)?"safari":/opera/.test(e)?"opera":/msie/.test(e)&&!/opera/.test(e)?"ie":/firefox/.test(e)&&!/(compatible|webkit)/.test(e)?"firefox":"unknow",o=(e.match(/.+(?:rv|me|it|ra|ie)[\/: ](\d+\.?\d*)/)||[0,"0"])[1];return{shell:n,version:o,os:i,pf:t}}),function(){function t(t,e){return this.type=t||"ARRAY_BUFFER",this._buffer=i.createBuffer(),e?this.data(e):this}function e(){return this._data=i.createTexture(),this._index=1,arguments.length&&this.data.apply(this,Array.prototype.slice.call(arguments)).setting({TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this}var i=null,n=window.webgl={init:function(t,e){e=e||{};var n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)||t.getContext("webkit-3d",e)||t.getContext("moz-webgl",e);return n.clearColor(0,0,0,0),this.activate(n),i.vs=i.createShader(i.VERTEX_SHADER),i.fs=i.createShader(i.FRAGMENT_SHADER),i.program=i.createProgram(),i.__varObj={},n},activate:function(t){return n.gl=i=t,this},elementBuffer:function(e){return new t("ELEMENT_ARRAY_BUFFER",e)},arrayBuffer:function(e){return new t("ARRAY_BUFFER",e)},texture2d:function(t,i,n,o){return new e(t,i,n,o)},creat:function(t,e){return i.shaderSource(i.vs,t),i.shaderSource(i.fs,e),i.compileShader(i.vs),i.compileShader(i.fs),i._source=[t,e],this},use:function(){return i.attachShader(i.program,i.vs),i.attachShader(i.program,i.fs),i.linkProgram(i.program),this._an(i._source[0]+i._source[1]),i.useProgram(i.program),this},_an:function(t){t.replace(/\b(attribute|uniform)\b[^;]+?(\w+)\s+(\w+)\s*;/g,function(t,e,n,o){var s,r,a,h=0|n.match(/\d+$|$/g,"")[0]||1,c=1;if("attribute"==e){if(s=i.getAttribLocation(i.program,o),0>s)return;i.enableVertexAttribArray(s),c=0}else{if(s=i.getUniformLocation(i.program,o),!s)return;r=/int|sampler/.test(n)?"i":"f",a=/^mat/.test(n)}i.__varObj[o]={size:h,loc:s,type:c,data:null,ismat:a,field:a?"uniformMatrix"+h+"fv":"uniform"+h+r+"v"}})},set:function(t,e){if(1==arguments.length){if("object"==typeof t)for(var o in t)this.set(o,t[o]);else if("string"==typeof t)return i.__varObj[t].data}else if(2==arguments.length&&i.__varObj[t]){i.__varObj[t].data=e;var s=i.__varObj[t];0==s.type?("[object Array]"===Object.prototype.toString.call(e)||"[object Float32Array]"===Object.prototype.toString.call(e)?(e=n[0==i.__varObj[t].type?"arrayBuffer":"elementBuffer"](e),i.__varObj[t].buff=e):e.bind(),i.vertexAttribPointer(i.__varObj[t].loc,i.__varObj[t].size,i.FLOAT,!1,0,0)):s.ismat?i[s.field](s.loc,!1,new Float32Array(e)):i[s.field](s.loc,e instanceof Array?e:[e])}return this},get:function(t){return i.__varObj[t]?i.__varObj[t]:null
},clear:function(){for(var t,e=0,n=arguments.length;t=arguments[--n];)e|=i[t+"_BUFFER_BIT"];return e&&i.clear(e),this},color:function(t){return"[object Array]"!==Object.prototype.toString.call(t)&&(t=Array.prototype.slice.call(arguments)),i.clearColor.apply(i,t),this},draw:function(t,e){return e=i[e||"TRIANGLES"],t._buffer?i.drawElements(e,t.bind().data().length,i.UNSIGNED_SHORT,0):i.drawArrays(e,0,t),this},drawElements:function(t,e){return i.drawElements(i[t],e,i.UNSIGNED_SHORT,0),this},viewport:function(t,e){i.viewport(0,0,t,e)},setting:function(t){var e={DEPTH_TEST:"depthFunc",BLEND:"blendFunc",CULL_FACE:null};for(var n in t)null===t[n]?i.disable(i[n]):(i.enable(i[n]),e[n]&&i[e[n]](i[t[n]]));return this},isBuffer:function(e){return e instanceof t},bindTexture:function(t){return t.bind(),this},unbindTexture:function(t){return t.isbind()&&i.bindTexture(i.TEXTURE_2D,null),this}};t.prototype={bind:function(){return i.bindBuffer(i[this.type],this._buffer),this},isbind:function(){return i.getParameter(i[type+"_BINDING"])==this._buff},unbind:function(){return this.isbind()&&i.bindBuffer(i[this.type],null),this},data:function(t){return void 0===t?this._data:(this.bind(),this._data=t,this._rawdata=new("ARRAY_BUFFER"==this.type?Float32Array:Uint16Array)(t),i.bufferData(i[this.type],this._rawdata,i.STATIC_DRAW),this)},dispose:function(){return i.deleteBuffer(this._buff),this._buff=null,this}},e.prototype={bind:function(t){return void 0==t&&(this._index=t),i.bindTexture(i.TEXTURE_2D,this._data),this},unbind:function(){return this.isbind()&&i.bindTexture(i.TEXTURE_2D,null),this},isbind:function(){return this._index==i.getParameter(i.TEXTURE_BINDING_2D)},data:function(t,e,n,o){this.bind(this._index),e=i[e];var s=t instanceof HTMLElement?[i.TEXTURE_2D,0,e,e,i.UNSIGNED_BYTE,t]:[i.TEXTURE_2D,0,e,n,o,0,e,i.UNSIGNED_BYTE,t?new Uint8Array(t):null];return i.texImage2D.apply(i,s),this},setting:function(t,e){if(this.bind(this._index),2==arguments.length)i.texParameteri(i.TEXTURE_2D,i[t],i[e]);else for(var n in t)i.texParameteri(i.TEXTURE_2D,i[n],i[t[n]]);return this},read:function(t,e,n,o){var n=n||1,o=o||1,s=new Uint8Array(n*o*4);return this.bind(this._index),i.readPixels(t,e,n,o,i.RGBA,i.UNSIGNED_BYTE,s),s},generate:function(){return this.bind(this._index),i.generateMipmap(i.TEXTURE_2D),this},dispose:function(){return i.deleteTexture(this._data),this}}}(),P.module("P.control.Control",[],function(){function t(t){P.setOptions(this,t)}return t.prototype={_container:null,options:{position:"topleft"},getPosition:function(){return this.options.position},setPosition:function(t){return this.options.position=t,this},getContainer:function(){return this._container},addTo:function(t){null===t?(this._pano._control.removeChild(this._container),this._pano=null):(this._pano=t,this._pano._control.appendChild(this._container),P.css(this._container,{"z-index":2e3+this._pano._controlStamp++}),this.onAdd())},onAdd:function(){},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._pano=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._pano&&this._pano.getContainer().focus()}},t}),P.module("P.control.Loading",["P.control.Control"],function(t){function e(t){P.setOptions(this,t),this._container=P.creat("div",null,"pano-loading",null,"height:3px;background:#67CF22;top:0;left:0;width:0%;transition:all 0.5s;-webkit-transition:all 1s;")}return P.inherit(e,t,{onAdd:function(){this._pano.addEventListener("load_tiles",this.onProcess,this)},onProcess:function(t){var e=100*t.loaded/t.total+"%";this._container.style.width=e,t.loaded==t.total?this.hide():this.show()},show:function(){this._container.style.opacity="1"},hide:function(){this._container.style.opacity="0"}}),e}),P.module("P.core.math.Math",[],function(){return{RADTODEG:180/Math.PI,DEGTORAD:Math.PI/180}}),P.module("P.core.math.Matrix",["P.core.math.Math"],function(t){function e(t){void 0==t&&(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.n11=t[0],this.n12=t[1],this.n13=t[2],this.n14=t[3],this.n21=t[4],this.n22=t[5],this.n23=t[6],this.n24=t[7],this.n31=t[8],this.n32=t[9],this.n33=t[10],this.n34=t[11],this.n41=t[12],this.n42=t[13],this.n43=t[14],this.n44=t[15]}return e.prototype={reset:function(){return this.n11=this.n22=this.n33=this.n44=1,this.n12=this.n13=this.n14=this.n21=this.n23=this.n24=this.n31=this.n32=this.n34=this.n41=this.n42=this.n43=0,this},copy:function(t){return this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this},clone:function(){return new e([this.n11,this.n12,this.n13,this.n14,this.n21,this.n22,this.n23,this.n24,this.n31,this.n32,this.n33,this.n34,this.n41,this.n42,this.n43,this.n44])},toArray:function(){return[this.n11,this.n12,this.n13,this.n14,this.n21,this.n22,this.n23,this.n24,this.n31,this.n32,this.n33,this.n34,this.n41,this.n42,this.n43,this.n44]},transpose:function(){return new e([this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44])},invert:function(){var t=new e;return t.copyFrom(this),t.calculateInverse(this),t},copyFrom:function(t){return"[object Array]"===Object.prototype.toString.call(t)?(this.n11=t[0],this.n12=t[1],this.n13=t[2],this.n14=t[3],this.n21=t[4],this.n22=t[5],this.n23=t[6],this.n24=t[7],this.n31=t[8],this.n32=t[9],this.n33=t[10],this.n34=t[11],this.n41=t[12],this.n42=t[13],this.n43=t[14],this.n44=t[15]):(this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44),this},det:function(){return(this.n11*this.n22-this.n21*this.n12)*this.n33-(this.n11*this.n32-this.n31*this.n12)*this.n23+(this.n21*this.n32-this.n31*this.n22)*this.n13},calculateInverse:function(t){var e=t.det();if(Math.abs(e)>.001){e=1/e;var i=t.n11,n=t.n21,o=t.n31,s=t.n12,r=t.n22,a=t.n32,h=t.n13,c=t.n23,u=t.n33,l=t.n14,p=t.n24,d=t.n34;this.n11=e*(r*u-a*c),this.n12=-e*(s*u-a*h),this.n13=e*(s*c-r*h),this.n14=-e*(s*(c*d-u*p)-r*(h*d-u*l)+a*(h*p-c*l)),this.n21=-e*(n*u-o*c),this.n22=e*(i*u-o*h),this.n23=-e*(i*c-n*h),this.n24=e*(i*(c*d-u*p)-n*(h*d-u*l)+o*(h*p-c*l)),this.n31=e*(n*a-o*r),this.n32=-e*(i*a-o*s),this.n33=e*(i*r-n*s),this.n34=-e*(i*(r*d-a*p)-n*(s*d-a*l)+o*(s*p-r*l))}}},e.multiplyVector=function(t,e){var i=t.x,n=t.y,o=t.z,s=t.w;return t.x=i*e.n11+n*e.n12+o*e.n13+s*e.n14,t.y=i*e.n21+n*e.n22+o*e.n23+s*e.n24,t.z=i*e.n31+n*e.n32+o*e.n33+s*e.n34,t.w=i*e.n41+n*e.n42+o*e.n43+s*e.n44,t},e.multiplyVector3x3=function(t,e){var i=e.x,n=e.y,o=e.z;e.x=i*t.n11+n*t.n12+o*t.n13,e.y=i*t.n21+n*t.n22+o*t.n23,e.z=i*t.n31+n*t.n32+o*t.n33},e.multiply=function(t,i){var n=t.n11,o=i.n11,s=t.n21,r=i.n21,a=t.n31,h=i.n31,c=t.n41,u=i.n41,l=t.n12,p=i.n12,d=t.n22,f=i.n22,_=t.n32,v=i.n32,m=t.n42,g=i.n42,P=t.n13,y=i.n13,b=t.n23,w=i.n23,x=t.n33,M=i.n33,T=t.n43,D=i.n43,z=t.n14,L=i.n14,E=t.n24,S=i.n24,j=t.n34,C=i.n34,O=t.n44,k=i.n44;return new e([n*o+l*r+P*h+z*u,n*p+l*f+P*v+z*g,n*y+l*w+P*M+z*D,n*L+l*S+P*C+z*k,s*o+d*r+b*h+E*u,s*p+d*f+b*v+E*g,s*y+d*w+b*M+E*D,s*L+d*S+b*C+E*k,a*o+_*r+x*h+j*u,a*p+_*f+x*v+j*g,a*y+_*w+x*M+j*D,a*L+_*S+x*C+j*k,c*o+m*r+T*h+O*u,c*p+m*f+T*v+O*g,c*y+m*w+T*M+O*D,c*L+m*S+T*C+O*k])},e.euler2matrix=function(i){var n=t.DEGTORAD,o=new e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),s=i.x*n,r=i.y*n,a=i.z*n,h=Math.cos(s),c=Math.sin(s),u=Math.cos(r),l=Math.sin(r),p=Math.cos(a),d=Math.sin(a),f=h*l,_=c*l;return o.n11=u*p,o.n12=-u*d,o.n13=l,o.n21=_*p+h*d,o.n22=-_*d+h*p,o.n23=-c*u,o.n31=-f*p+c*d,o.n32=f*d+c*p,o.n33=h*u,o},e.lookAt=function(t,i,n){var o=t.sub(i).normalize(),s=n.cross(o).normalize(),r=o.cross(s);return new e([s.x,r.x,o.x,0,s.y,r.y,o.y,0,s.z,r.z,o.z,0,-s.dot(t),-r.dot(t),-o.dot(t),1])},e.rotate=function(e,i,n){var o=t.DEGTORAD,s=Math.sin(i*o),r=Math.cos(i*o),a=e.n11,h=e.n21,c=e.n31,u=e.n12,l=e.n22,p=e.n32,d=e.n13,f=e.n23,_=e.n33,v=e.n14,m=e.n24,g=e.n34;return"x"==n&&(e.n21=h*r+c*s,e.n22=l*r+p*s,e.n23=f*r+_*s,e.n24=m*r+g*s,e.n31=h*-s+c*r,e.n32=l*-s+p*r,e.n33=f*-s+_*r,e.n34=m*-s+g*r),"y"==n&&(e.n11=a*r+c*-s,e.n12=u*r+p*-s,e.n13=d*r+_*-s,e.n14=v*r+g*-s,e.n31=a*s+c*r,e.n32=u*s+p*r,e.n33=d*s+_*r,e.n34=v*s+g*r),e},e}),P.module("P.core.math.Vector3",["P.core.math.Math"],function(t){function e(t,e,i){this.x=t,this.y=e,this.z=i,this.w=1}return e.prototype={toArray:function(){return[this.x,this.y,this.z]},plus:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},minus:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},multiply:function(t){return this.x*=t,this.y*=t,this.z*=t,this},normalize:function(){var t=1/this.modulo();return this.multiply(t)},project:function(){var t=this.w;return this.x/=t,this.y/=t,this.z/=t,this.w=1,this},sub:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},add:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return this.modulo()},modulo:function(){return Math.sqrt(this.modulo2())},modulo2:function(){return this.x*this.x+this.y*this.y+this.z*this.z},sqrDistToline:function(t,e){var i=e.sub(t),n=this.sub(t),o=(this.sub(e),n.dot(i.normalize())),s=n.length();return s*s-o*o},clone:function(){return new e(this.x,this.y,this.z)},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},rotate:function(t){return e(this,t)},rotateX:function(e){e*=t.toRADIANS;var i=Math.cos(e),n=Math.sin(e),o=this.clone();return this.y=o.y*i-o.z*n,this.z=o.y*n+o.z*i,this},rotateY:function(e){e*=t.toRADIANS;var i=Math.cos(e),n=Math.sin(e),o=this.clone();return this.x=o.x*i+o.z*n,this.z=o.x*-n+o.z*i,this},toSpherical:function(t){var i=this.modulo(),n=Math.atan2(this.x,this.z),o=Math.asin(this.y/i);return t===!0&&(n*=180/Math.PI,n=(n+36e4)%360,o*=-180/Math.PI),new e(n,o,i)},toXYZ:function(t){var e=this.x,i=this.y,n=this.z;t===!0&&(e>180&&(e-=360),i*=-1,e*=Math.PI/180,i*=Math.PI/180);var o=n,s=o*Math.sin(i),r=o*Math.cos(i)*Math.sin(e),a=o*Math.cos(i)*Math.cos(e);return this.x=r,this.y=s,this.z=a,this},intersectTriangle:function(t,i,n){P.isArray[t]&&(i=t[1],n=t[2],t=t[0]);var o,s,r,a,h=i.sub(t),c=n.sub(t),u=this.cross(c),l=h.dot(u);if(l>0?o=e.ZERO().sub(t):(o=t.sub(e.ZERO()),l=-l),1e-4>l)return!1;if(r=o.dot(u),0>r||r>l)return!1;var p=o.cross(h);if(a=this.dot(p),0>a||r+a>l)return!1;s=c.dot(p);var d=1/l;return s*=d,r*=d,a*=d,s}},e.add=function(t,i){return new e(t.x+i.x,t.y+i.y,t.z+i.z)},e.sub=function(t,i){return new e(t.x-i.x,t.y-i.y,t.z-i.z)},e.dot=function(t,i){return new e(t.x*i.x,t.y*i.y,t.z*i.z)},e.multiply=function(t,i){return new e(t.x*i,t.y*i,t.z*i)},e.ZERO=function(){return new e(0,0,0)},e.divide=function(t,i){return new e(t.x/i,t.y/i,t.z/i)},e}),P.module("P.core.Camera",["P.core.math.Math","P.core.math.Matrix","P.core.math.Vector3","P.base.utils"],function(t,e,i,n){function o(t){this._vp=[new i(-1,1,1),new i(1,1,1),new i(1,-1,1),new i(-1,-1,1)],this._vp_prj=[new i(-1,1,1),new i(1,1,1),new i(1,-1,1),new i(-1,-1,1)],this._fovtype=t||"mfov"}return o.prototype={near:.1,far:1e4,fov:120,_hfov:1,_vfov:1,_bfov:1,_vp:[],_vp_r:[],_rx:0,_ry:0,_fovtype:"mfov",_viewmat:new e,_viewMat:new e,_perspMat:new e,_projMat:new e,_wowrot:new e,_screenmat:new e,_vp_prj:[],_focus:256,BEHIND:0,update:function(t,e,i){if(this._vw=t,t/=2,this._vh=e,e/=2,this._vp[0].x=this._vp[3].x=-t,this._vp[1].x=this._vp[2].x=t,this._vp[0].y=this._vp[1].y=e,this._vp[2].y=this._vp[3].y=-e,this._screenmat.copyFrom([t,0,0,0,0,-e,0,0,0,0,1,0,t,e,0,1]),void 0!=i){this.fov=i;var n=e/t;"mfov"==this._fovtype?(n>.75&&(n=.75),this._hfov=360*Math.atan(.75/n*Math.tan(i*Math.PI/360))/Math.PI,this._vfov=360*Math.atan(n*Math.tan(i*Math.PI/360))/Math.PI,this._bfov=this._vfov):"vfov"==this._fovtype?(this._hfov=360*Math.atan(1/n*Math.tan(i*Math.PI/360))/Math.PI,this._vfov=i,this._bfov=this._vfov):"hfov"==this._fovtype&&(this._hfov=i,this._vfov=360*Math.atan(n*Math.tan(i*Math.PI/360))/Math.PI,this._bfov=this._vfov),this._focus=e/Math.tan(this._bfov*Math.PI/360),this._vp[0].z=this._vp[1].z=this._vp[2].z=this._vp[3].z=this._focus,this._updatePerspMat(),this._updateProjMat()}},_getFovByFocus:function(t){var e=this._vh,i=this._vw,n=e/i,o=360*Math.atan(e/t)/Math.PI,s=360*Math.atan(Math.tan(o*Math.PI/360)/n)/Math.PI;return s},getTilesFor2D:function(t,e){for(var i=[],n=this._focus,o=this._vw/n,s=this._vh/n,r=this._ry/360,a=(90+this._rx)/180,h=1;e>=h;h++)i=i.concat(this.getTilesFor2DByLevel(r,a,o,s,h,t));return i},getPovFor2D:function(t){var e=this._focus,i=(0-t.x)/e/8,n=(0-t.y)/e/4;return{pitch:180*n,heading:360*i}},getViewportFor2D:function(){if(void 0==this._vw||void 0==this._vh)return[0,0];var t=this._focus,e=this._vw/t,i=this._vh/t;return[e,i]},getTilesFor2DByLevel:function(t,e,i,n,o){var s=[],r=1<<o,a=1/r;t=4*t;var h=t-.5*i,c=t+.5*i,u=e-.5*n,l=e+.5*n;h=Math.floor(h/a),c=Math.floor(c/a),u=Math.floor(u/a),l=Math.floor(l/a);for(var p=h;c>=p;p++)for(var d=u;l>=d;d++)d>=0&&r>d&&s.push([p,d,o]);return s},rotate:function(t,i){this._ry=t,this._rx=i,this._viewmat=e.euler2matrix({x:-this._rx,y:-this._ry,z:0}),e.rotate(this._viewMat.reset(),-this._rx,"x"),e.rotate(this._viewMat,-this._ry,"y"),this._modmat=e.euler2matrix({x:this._rx,y:this._ry,z:0}),this._wowrot=this._viewmat.transpose(),this._updateProjMat()},intersect:function(t){var i=this._vp,n=t.clone();e.multiplyVector3x3(this._viewmat,n);var o=n.intersectTriangle(i[0],i[1],i[2]);return o===!1&&(o=n.intersectTriangle(i[0],i[2],i[3])),o},intersectSquare:function(t,e,i,o){return n.isArray(t)&&(e=t[1],i=t[2],o=t[3],t=t[0]),this.inFrustum([t,e,i,o])>=0},deepCull:function(){},clip:function(t){var e,i,n,o,s,r,a={},h=function(t){return(i.x-e.x)*(t.y-e.y)>(i.y-e.y)*(t.x-e.x)},c=function(){var t={x:e.x-i.x,y:e.y-i.y},s={x:n.x-o.x,y:n.y-o.y},r=e.x*i.y-e.y*i.x,a=n.x*o.y-n.y*o.x,h=1/(t.x*s.y-t.y*s.x);return{x:(r*s.x-a*t.x)*h,y:(r*s.y-a*t.y)*h}},u=t;for(e=a[a.length-1],r=0;r<a.length;r++){i=a[r];var l=u;for(u=[],n=l[l.length-1],s=0;s<l.length;s++){var o=l[s];h(o)?(h(n)||u.push(c()),u.push(o)):h(n)&&u.push(c()),n=o}e=i}return u},cameraProject:function(t){var i=t.clone();return e.multiplyVector3x3(this._viewmat,i),i},_projectSphere:function(t){return t=new i(t.x,t.y,this._focus).toXYZ(!0),this.project(t)},_unprojectSphere:function(t){return this.unproject({x:t.x,y:t.y}).toSpherical(!0)},_updatePerspMat:function(){var t=this._vw/this._vh,e=1/Math.tan(this._bfov*Math.PI/360);this._perspMat.copyFrom([e/t,0,0,0,0,e,0,0,0,0,-(this.far+this.near)/(this.near-this.far),1,0,0,2*this.near*this.far/(this.near-this.far),0])},getProjectionMatrix:function(){return this._perspMat.toArray()},getViewMatrix:function(){return this._viewMat.toArray()},_modmat:new e,_updateProjMat:function(t,i){var t=this._perspMat,i=this._viewMat;this._projMat.copyFrom(e.multiply(i,t))},project2:function(t){return e.multiplyVector(t,this._projMat.transpose()),e.multiplyVector(t.project(),this._screenmat.transpose()),{x:t.x,y:t.y,z:t.z,w:t.w}},projectToView:function(t){return e.multiplyVector(t,this._projMat.transpose()),t.project()},pointInFrustum:function(t){var n=[0,0,0],o=new i;e.multiplyVector(o.copyFrom(t),this._projMat.transpose()).project();var s=(o.x+1)/2,r=(o.y+1)/2,a=(o.z+1)/2;return 0>s&&(n[0]=-1),s>1&&(n[0]=1),0>r&&(n[1]=-1),r>1&&(n[1]=1),(0>a||a>1)&&(n[2]=1),n},inFrustum:function(t){for(var e=t.length,n=(new i,[0,0,0]),o=0;e>o;o++){var s=this.pointInFrustum(t[o]);n[0]+=s[0],n[1]+=s[1],n[2]+=s[2]}return n[0]==-e||n[0]==e||n[1]==-e||n[1]==e||n[2]==e?-1:1},project:function(t){var n=this._vp,o=t.clone();e.multiplyVector3x3(this._viewmat,o);var s=o.intersectTriangle(n[0],n[1],n[2]);if(s===!1&&(s=o.intersectTriangle(n[0],n[2],n[3])),s!==!1&&s>=0){var r=i.multiply(o,s);return{x:r.x+this._vw/2,y:this._vh/2-r.y}}return void 0},unproject:function(t){var n=t.x-this._vw/2,o=this._vh/2-t.y;return t=new i(n,o,this._focus),e.multiplyVector3x3(this._wowrot,t),t}},o}),P.module("P.core.geom.Latlng",[],function(){function t(t,e){this.lat=t||0,this.lng=e||0}return t.prototype={toMercator:function(){var e=20037508.34,i=this.lng*e/180,n=Math.log(Math.tan((90+this.lat)*Math.PI/360))/Math.PI*e;return new t(i,n)},getLat:function(){return this.lat},getLng:function(){return this.lng},toString:function(){return"lng="+this.lng+",lat="+this.lat},toUrlValue:function(){return this.lat+","+this.lng},clone:function(){return new P.geom.Latlng(this.lat,this.lng,this.noWrap)},equals:function(t){var e=!1;return null!=t&&(e=this.lng==t.lng&&this.lat==t.lat||isNaN(this.lng)&&isNaN(this.lat)&&isNaN(t.lng)&&isNaN(t.lat)),e},distanceTo:function(t){var e=6378137,i=(Math.PI,Math.PI/180),n=this.lat,o=this.lng,s=t.lat,r=t.lng;n*=i,s*=i;var a=n-s,h=o*i-r*i,c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(n)*Math.cos(s)*Math.pow(Math.sin(h/2),2)));return c*=e,c=Math.round(1e4*c)/1e4}},t}),P.module("P.core.geom.Point",[],function(){function t(t,e){this.x=t,this.y=e}return P.point=function(e,i){return e instanceof t?e:P.isArray(e)?new t(e[0],e[1]):void 0===e||null===e?e:new t(e,i)},t.prototype={clone:function(){return new t(this.x,this.y)},add:function(t){return P.point(this.x+t.x,this.y+t.y)},subtract:function(t){return P.point(this.x-t.x,this.y-t.y)},interpolate:function(e,i){return new t(this.x*i+e.x*(1-i),this.y*i+e.y*(1-i))},divide:function(t){return this.x/=t,this.y/=t,this},equals:function(t){return t=P.point(t),t.x===this.x&&t.y===this.y},normalise:function(){},angle:function(){},rotate:function(t,e){e=e!==!0?!1:!0,e&&(t*=math.DEGTORAD);var i=Math.cos(t),n=Math.sin(t),o=this.clone();this.x=o.x*i-o.y*n,this.y=o.x*n+o.y*i},distanceTo:function(t){t=P.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},contains:function(t){return t=P.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){}},t}),P.module("P.core.geom.spherical",[],function(){return{computeHeading:function(t,e){var i=Math.PI/180,n=180/Math.PI,o=t.lat*i,s=e.lat*i,r=e.lng*i-t.lng*i,a=Math.atan2(Math.sin(r)*Math.cos(s),Math.cos(o)*Math.sin(s)-Math.sin(o)*Math.cos(s)*Math.cos(r))*n;return 0>a&&(a+=360),a},computeHeading2:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,s=t.lng*i,r=e.lng*i,a=Math.sin(o)*Math.sin(n),h=Math.cos(o)*Math.cos(n),c=Math.cos(r-s),u=h*c,l=a+u,p=Math.atan(-l/Math.sqrt(-l*l+1))+2*Math.atan(1);a=Math.sin(n)-Math.sin(o)*Math.cos(p),h=Math.cos(o)*Math.sin(p),c=a/h;var d;return Math.sin(s-r)<0?(u=Math.atan(-c/Math.sqrt(-c*c+1))+2*Math.atan(1),d=u):(u=-c*c+1,l=2*Math.PI-(Math.atan(-c/Math.sqrt(-c*c+1))+2*Math.atan(1)),d=l),180*d/Math.PI},computeOffset:function(t,e,i,n){var o=Math.PI/180,s=180/Math.PI,r=6378137,a=i*o,h=t.lat*o,c=t.lng*o,u=e/(n||r),l=Math.asin(Math.sin(h)*Math.cos(u)+Math.cos(h)*Math.sin(u)*Math.cos(a)),p=c+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(h),Math.cos(u)-Math.sin(h)*Math.sin(l));return{lat:l*s,lng:p*s}},computeOffset2:function(t,e,i,n){var o=Math.PI/180,s=180/Math.PI,r=6378137,a=e/(n||r),h=i*o,c=t.lat*o,u=Math.cos(a);a=Math.sin(a);var l=Math.sin(c),c=Math.cos(c),p=u*l+a*c*Math.cos(h);return{lat:Math.asin(p)*s,lng:(t.lng*o+Math.atan2(a*c*Math.sin(h),u-l*p))*s}},computeDistance:function(t,e){var i=6378137,n=(Math.PI,Math.PI/180),o=t.lat*n,s=e.lat*n,r=(e.lng-t.lng)*n;return i*Math.acos(Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos(r))}}}),P.module("P.core.object.CubePreview",[],function(){function t(t){this.prefix=P.prefix.css,this.scene=t,this._pano=t._pano,this.prefix=P.prefix.css,this.size=256,this.init()}function e(t){t&&this.load(t)}return t.prototype={ready:void 0,list:[],_positionTransform:{l:"rotateY(90deg)",f:"rotateY(0deg)",r:"rotateY(-90deg)",b:"rotateY(180deg)",u:"rotateX(-90deg)",d:"rotateX(90deg)"},reset:function(){this.clear(),this.ready=void 0},getTransform:function(t){var e=(this.size,this._pano.getViewWidth()),i=this._pano.getViewHeight(),n=this._pano._camera._focus,o=-this._pano.pitch;return"translate("+e/2+"px, "+i/2+"px) translateY(0px) perspective("+n+"px) rotateZ(0deg) translateZ("+(n+1e-10)+"px) rotateX("+o+"deg) rotateY("+this._pano.heading+"deg) "+t},init:function(){this._container=P.creat("div","pano-scene-preview",null,this.scene._viewport,"position:absolute;left:0;top:0;")},render:function(){var t=this.prefix+"transform";for(var e in this.list)this.list[e].obj.style[t]=this.getTransform(this.list[e].transform)},clear:function(){for(var t in this.list)this._container.removeChild(this.list[t].obj),this.list[t].obj=null;this.list=[]},addThumb:function(t,e,i,n,o){var s=[t,e,i,0].join("_"),r=.5*this.size,a=-r;e-=1,i-=1;var h=e*r,c=i*r,u=this._positionTransform[t]+" translate3d("+h+"px,"+c+"px,"+a+"px)",l=this.size,p=o[2],d=l/p,f=P.creat("div","pano-tile-"+s,null,this._container,"overflow: hidden; position: absolute;width:"+l+"px;height:"+l+"px;background:url("+n.src+") -"+o[0]*d+"px "+(0-o[1]*d)+"px no-repeat;background-size:"+n.width*d+"px "+n.height*d+"px;"+this.prefix+"transform-origin: 0px 0px;"+this.prefix+"transform:"+this.getTransform(u));this.list.push({id:s,obj:f,transform:u})},load:function(t){var i,n=this;new e(t).success(function(t){n.clear();var e=t.height,o=t.height,s=t.width,r=0;6==Math.round(s/o)&&(r=0),1.5==Math.round(s/o)&&(r=1,e*=.5),6==Math.round(o/s)&&(r=2,e=s);for(var a=[[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0]],[[0,0],[1,0],[2,0],[0,1],[1,1],[2,1]],[[0,0],[0,1],[0,2],[0,3],[0,4],[0,5]]][r],h=["f","r","b","l","u","d"],c=0;c<h.length;c++){i=h[c];var u=[a[c][0]*e,a[c][1]*e,e,e,0,0,n.size,n.size];n.addThumb(i,0,0,t,u)}t=null,n.ready=!0,n.scene._pano.render(),console.log()}).error(function(){})}},e.prototype={_successFn:null,_image:null,_status:null,_process:0,load:function(t){return this._image=new Image,P.on(this._image,"load",this._onload,this),P.on(this._image,"error",this._onerror,this),this._image.src=t,this},_onload:function(){return this._process=1,this._status="success","function"==typeof this._successFn&&this._successFn(this._image),this._image=null,this},_onerror:function(){this._process=2,this._status="error"},success:function(t){return this._successFn=t,"success"==this._status&&0==this._process&&this._successFn(this._image),this},error:function(t){this._errorFn=t,"error"==this._status&&0==this._process&&this._errorFn(this._image)},CLASS_NAME:"P.object.Loader"},t}),P.module("P.core.object.Cube",["P.base.http","P.base.feature","P.core.object.CubePreview","P.core.math.Vector3","P.core.geom.spherical"],function(t,e,i,n,o){function s(t){this.prefix=P.prefix.css,e.androidnative&&(this._onceMode=!0),t&&this.addTo(t)}return s.prototype={_pano:null,options:{},_ignoneLv0:!1,_stamp:0,tilesize:512,_current:[],_currentCache:{},_tiles:{},_tilesCache:[],_maxTiles:64,_maxCache:128,_onceMode:!1,_totalTiles:0,_previewReady:null,vert:["attribute vec3 a_vp;","attribute vec2 a_tp;","attribute float a_alpha;","uniform mat4 u_view;","uniform mat4 u_persp;","varying mediump vec2 v_tp;","void main(void) {","gl_Position = u_persp * u_view * vec4(a_vp, 1);","v_tp = a_tp;","}"].join(""),frag:["varying mediump vec2 v_tp;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_tp);","}"].join(""),data:{},_fz:[6,24,96,384],_fz2:[6,24,96,384],vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],_positionTransform:{l:"rotateY(90deg)",f:"rotateY(0deg)",r:"rotateY(-90deg)",b:"rotateY(180deg)",u:"rotateX(-90deg)",d:"rotateX(90deg)",roads:""},reset:function(){this._tilesCache=[],this._loaderQueue&&this._loaderQueue.clear();for(var t in this._tiles)this._removeTile(t);this._fz=[6,24,96,384],this._preview.render(),this._preview.ready=void 0},_creatTileForCss:function(t,e,i,n,o,s){var r=[t,e,i,n,this._pano._panoid].join("_");-1==n&&(n=0);var a=1<<n,h=0==n?1:a/2;s=arguments.length<5?!0:s;var c=0==n?.5*this.tilesize:this.tilesize,u=-c/2<<n;0==n&&(u=-c),e-=h,i-=h;var l=e*c,p=i*c,d=this._positionTransform[t]+" translate3d("+l+"px,"+p+"px,"+u+"px)",f=P.creat("img","pano-tile-"+r,"transformFade",this._container,"overflow: hidden; position: absolute; "+this.prefix+"transform-origin: 0px 0px; "+this.prefix+"transform:"+this._pano._render.getTransform(d));f.width=f.height=this.tilesize,f.src=o.src;var _={id:r,useClip:s,timestamp:this._stamp++,obj:f,transform:d};return this._tiles[r]=_,this._tilesCache.unshift(_),f},_creatTileForWebGL:function(t,e,i,n){var o={texture:webgl.texture2d(t,"RGB").unbind(),vertices:e,useClip:n,id:i,timestamp:this._stamp++};this._tiles[i]=o,this._tilesCache.unshift(o)},_removeTile:function(t){this._tiles[t]&&("webgl"==this.render?this._tiles[t].texture.dispose():"css"==this.render&&(this._container.removeChild(this._tiles[t].obj),this._tiles[t].obj=null),this._tiles[t]=null,delete this._tiles[t])},_removeTilesByLevel:function(t){for(var e in this._currentCache)this._currentCache[e].deep==t&&this.removeTile(this._currentCache[e].id)},_updateTiles:function(){if(this._totalTiles=0,this._tilesCache.sort(this._sortCache),this._tilesCache.length>this._maxCache+50)for(var t=this._tilesCache.length-1;t>this._maxCache;t--){var e=this._tilesCache[t].id;this._tiles[e]&&1==this._tiles[e].useClip&&this._removeTile(e),this._tilesCache.splice(t,1)}this._totalTiles=this._tilesCache.length,this._pano.trigger("load_tiles",{loaded:this._totalTiles,total:this._fz2[this._pano.getDeep()-1]})},_onLoad:function(t,e){var i=t.id;if(i in this._currentCache&&!(i in this._tiles)){var n=(this._pano.getDeep(),i.split("_")),o=n[0],s=Number(n[1]),r=Number(n[2]),a=Number(n[3]);"webgl"==this.render?this._creatTileForWebGL(e,t.vertex,i,this._onceMode?!1:!0):"css"==this.render&&this._creatTileForCss(o,s,r,a,e,this._onceMode?!1:!0),this._pano.render(!1),1==this._onceMode&&this._fz[a]--,this._onceMode&&0==this._fz[a]&&0==a&&this._removeTilesByLevel(a-1),this._updateTiles()}},getMousePosition:function(){},addTo:function(e){this._pano=e,this._viewport=e._viewport,this._loaderQueue=new t.LoaderQueue({thread:1,onUpdate:P.bind(this._onLoad,this)}),this._initScene()},_initScene:function(){this._preview=new i(this),this._container=P.creat("div","pano-scene-main",null,this._viewport,"position:absolute;left:0;top:0;");this.prefix;this.render=this._pano.options.render,"webgl"==this.render&&this._initWebGL()},setSize:function(t,e){this.canvas&&(this.canvas.width=t,this.canvas.height=e,webgl.viewport(t,e))},_initWebGL:function(){var t=P.creat("canvas",null,"",this._container,null);t.width=t.height=256;webgl.init(t,{alpha:!0,depth:!1});this.canvas=t,webgl.creat(this.vert,this.frag).use().setting({CULL_FACE:!0}),this.data={vertBuffer:webgl.arrayBuffer(),texBuffer:webgl.arrayBuffer([0,1,1,1,1,0,0,0]),indexBuffer:webgl.elementBuffer([0,1,2,0,2,3])}},_checkTiles:function(){this._checkTilesInvalidate()},_checkTilesInvalidate:function(){if(void 0!=this._pano){if(null==this._pano._panoData)return void(this._tilecheckStatus=!1);if(void 0===this._preview.ready&&(this._preview.ready=!1,this._preview.load(this._pano._getTileUrl({x:0,y:0,z:-1}))),this._preview.ready!==!0)return void(this._tilecheckStatus=!1);{this._pano.getDeep()}if(this._onecMode&&0==this._fz[this._pano.maxDeep])return void(this._tilecheckStatus=!1);this._current=[],this._currentCache={};for(var t=this.vertices,e=0;6>e;e++){var i=12*e;this._checkFaceTile([new n(t[i+0],t[i+1],t[i+2]),new n(t[i+3],t[i+4],t[i+5]),new n(t[i+6],t[i+7],t[i+8]),new n(t[i+9],t[i+10],t[i+11])],!1)}this._updateTiles(),this._current.length>0&&(this._current.sort(this._sortQueue),this._loaderQueue.add(this._current)),this._tilecheckStatus=!1}},_checkFaceTile:function(t,e){var i=[],n=!1,o=[[3,4,1,0],[4,5,2,1],[6,7,4,3],[7,8,5,4]],s=this._pano._camera,r=Math.round(Math.log(2/t[0].sub(t[1]).modulo())/Math.LN2);e!==!1&&(e=!0);var a=this._pano.getDeep();if(a>this._pano._maxDeep&&(a=this._pano._maxDeep),n=e?s.intersectSquare(t):!0,n!==!1){a>=r&&(1!=this._ignoneLv0||0!=r)&&this.addTile(t,r),i[0]=t[3].clone(),i[1]=t[3].add(t[2]).multiply(.5),i[2]=t[2].clone(),i[3]=t[3].add(t[0]).multiply(.5),i[4]=t[3].add(t[1]).multiply(.5),i[5]=t[2].add(t[1]).multiply(.5),i[6]=t[0].clone(),i[7]=t[0].add(t[1]).multiply(.5),i[8]=t[1].clone();for(var h=0;4>h;h++){var c=[i[o[h][0]],i[o[h][1]],i[o[h][2]],i[o[h][3]]],u=s.intersectSquare(c);u&&a-1>=r&&this._checkFaceTile(c,!1)}}},_calcDist:function(t){var e=t[0].add(t[1]).add(t[2]).add(t[3]).multiply(.25).toSpherical(),i=(this._pano.pitch,this._pano.heading,180/Math.PI),n=e.y*i,s=e.x*i,r=-1*this._pano.pitch,a=this._pano.heading;return o.computeDistance({lat:n,lng:s},{lat:r,lng:a})},_sortCache:function(t,e){var i=e.timestamp-t.timestamp;return i},_sortQueue:function(t,e){if(0==t.deep&&0!=e.deep)return-1;if(0==e.deep&&0!=t.deep)return 1;var i=t.deep-e.deep;return 0==i&&(i=t.dist-e.dist),i},addTile:function(t,e){var i,n,o,s,r,a=1<<e,h=t[0].add(t[1]).add(t[2]).add(t[3]).multiply(.25),c=t[3],u=2/a;1==h.x?i="r":-1==h.x&&(i="l"),1==h.y?i="u":-1==h.y&&(i="d"),1==h.z?i="f":-1==h.z&&(i="b"),0==e?(n=0,o=0,e=0):("f"==i&&(s=c.x,r=c.y),"b"==i&&(s=-c.x,r=c.y),"l"==i&&(s=c.z,r=c.y),"r"==i&&(s=-c.z,r=c.y),"d"==i&&(s=c.x,r=c.z),"u"==i&&(s=c.x,r=-c.z),s+=1,r=1-r,n=Math.floor(s/u),o=Math.floor(r/u));var l=[i,n,o,e,this._pano._panoid].join("_"),p=Math.floor(this._calcDist(t));return l in this._tiles?void(this._tiles[l].timestamp=this._stamp++):(void 0==this._currentCache[l]&&(this._currentCache[l]={id:l,url:this._pano._getTileUrl({f:i,x:n,y:o,z:e,id:l}),deep:e,diff:p,vertex:this.getVertex(t)}),void this._current.push(this._currentCache[l]))},_searchCache:function(t){for(var e=0;e<this._tilesCache.length;e++)if(this._tilesCache[e].id==t)return e;return-1},getVertex:function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(t[i].toArray());return e},_creatArrow:function(t){this.roadList=[];for(var e=0;e<t.length;e++){var i=t[e].id,n=t[e].dir%360;this.roadList[e]=P.creat("canvas",null,null,this.roads,"display:none;overflow: hidden; position: absolute; "+this.prefix+"transform: rotateX("+n+"deg) translateY(-120px);",{"data-id":i})}},_creatCanvas:function(t){var e=P.creat("canvas",null,t,this._container,"display:none;overflow: hidden; position: absolute; "+this.prefix+"transform-origin: 0px 0px; ");return e.width=e.height=this.tilesize,e},_checkTexture:function(){(this._pano.getPov().heading+45)%90}},s}),P.module("P.interaction.Interaction",[],function(){function t(t){t&&this.addTo(t)}return t.prototype={addTo:function(t){return this.onAdd(t).enable(),this},onAdd:function(t){return this._pano=t,this},enable:function(){this._enabled||(this._enabled=!0,this.activate())},disable:function(){this._enabled&&(this.deactivate(),this._enabled=!1)},enabled:function(){return!!this._enabled},activate:function(){},deactivate:function(){},CLASS_NAME:"P.Interaction"},t}),P.module("P.interaction.DragObject",["P.interaction.Interaction","P.base.events","P.base.feature","P.base.dom","P.core.geom.Point"],function(t,e,i,n,o){function s(t,e){this._el=t,this._dragTarget=e||t}var r={START:i.touch?["touchstart","mousedown"]:["touchstart","mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend",mouseup:"mouseup",touchend:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove",mouseup:"mousemove",touchend:"touchmove"}};return s.prototype={ClassName:"P.interaction.DragObject",_moved:!1,_onactive:!1,activate:function(){if(!this._enabled){for(var t=r.START,e=t.length;e--;)P.on(this._el,t[e],this._onDown,this);this._enabled=!0}},deactivate:function(){if(this._enabled){for(var t=r.START,e=t.length;e--;)P.un(this._el,t[e],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(1!==t.which&&1!==t.button&&!t.touches||t.touches&&t.touches.length>1)return void(this._onactive=!1);n.event.stopPropagation(t);var e=t.touches?t.touches[0]:t;this._startPoint=new o(e.clientX,e.clientY),this._startPos=this._newPos=n.getPosition(this._el),this._onactive=!0,P.on(document,r.MOVE[t.type],this._onMove,this).on(document,r.END[t.type],this._onUp,this)
},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._onactive=!1);if(0!=this._onactive){var e=t.touches&&1===t.touches.length?t.touches[0]:t,s=new o(e.clientX,e.clientY),r=s.subtract(this._startPoint);(r.x||r.y)&&(i.touch&&Math.abs(r.x)+Math.abs(r.y)<2||(n.event.preventDefault(t),0==this._moved&&(this._dragTarget.trigger("dragstart",{pixel:this._newPoint,offset:r,distance:this._newPos.distanceTo(this._startPos)}),this._moved=!0,this._startPos=n.getPosition(this._element).subtract(r),this._startPoint=s,n.addClass(this._el,"pano-dragging"),this._lastTarget=t.target||t.srcElement),this._newPos=this._startPos.add(r),this._newPoint=s,this._dragTarget.trigger("dragging",{pixel:this._newPoint,offset:r,distance:this._newPos.distanceTo(this._startPos)})))}},_onUp:function(t){n.removeClass(this._el,"pano-dragging"),this._lastTarget&&(n.removeClass(this._lastTarget,"pano-drag-target"),this._lastTarget=null),P.un(document,r.MOVE[t.type],this._onMove).un(document,r.END[t.type],this._onUp),this._moved&&this._onactive&&this._dragTarget.trigger("dragend",{pixel:this._newPoint,distance:this._newPos.distanceTo(this._startPos)}),this._moved=!1,this._onactive=!1}},P.extend(s.prototype,e),s}),P.module("P.interaction.Drag",["P.interaction.Interaction","P.base.events","P.interaction.DragObject","P.base.kinetic"],function(t,e,i,n){function o(e){t.call(this,e)}return P.inherit(o,t,{CLASS_NAME:"P.interaction.Drag",mixin:e,controlMode:1,activate:function(){this._dragObj=new i(this._pano._dragMask,this),this.kinetic=new n,this._pano.kinetic=this.kinetic,this._dragObj.on({dragstart:this._onDragStart,dragging:this._onDragging,dragend:this._onDragEnd},this).activate()},_onDragStart_1:function(){this._pano.animation.clear(),this._pano._scene._loaderQueue.clear(),this._pano.kinetic.begin()},_onDragStart:function(){this.controlMode=this._pano.options.controlMode,this._pano.animation.clear(),this._pano._scene._loaderQueue.clear(),this._pano.kinetic.begin();var t=this._pano.getPov();this._ori={x:t.heading,y:t.pitch},this._ori_pov=this._pano._camera.unproject(this._dragObj._startPoint).toSpherical(!0),this.lastp=this._dragObj._startPoint,this.pole_s=this._pano._camera._projectSphere({x:t.heading,y:89.99}),this.pole_n=this._pano._camera._projectSphere({x:t.heading,y:-89.99}),this._opposite=void 0!=this.pole_s||void 0!=this.pole_n,this.kinetic.begin({x:t.heading,y:t.pitch}),this._lastnpov=this._ori_pov.x},deactivate:function(){this._draggable.deactivate()},_lastnpov:0,_onDragging:function(){var t,e;if(1==this.controlMode){var i=this._dragObj._newPoint.subtract(this.lastp),n=this._pano._camera.getPovFor2D(i);this.lastp=this._dragObj._newPoint,this._pano.setPov(n,!0)}else if(2==this.controlMode){var o=this._pano.getPov(),s=this._pano._camera.unproject(this._dragObj._newPoint).toSpherical(!0);if(this._lastnpov=s.x,e=this._ori_pov.y-s.y,t=this._ori_pov.x-s.x,Math.abs(t)>270&&(t>0?t-=360:t+=360),(this.pole_s&&this.pole_s.y<this._dragObj._startPoint.y||this.pole_n&&this.pole_n.y>this._dragObj._startPoint.y)&&(e=-(this._dragObj._newPoint.y-this.lastp.y)*this._pano._camera._bfov/this._pano.viewHeight,t=-(this._dragObj._newPoint.x-this.lastp.x)*this._pano._camera._bfov/this._pano.viewWidth,this.lastp=this._dragObj._newPoint),0==isNaN(t)&&0==isNaN(e)){var o={heading:t,pitch:e};this._pano.setPov(o,!0,!1)}}else 0==this.controlMode;var i=this._pano.getPov();this._pano.trigger("move").trigger("pov_changed",i),this.kinetic.update(i.heading,i.pitch)},_onDragEnd:function(){var t=this._pano.getPov(),e=this.kinetic.end();if(e){var i=this.kinetic.getDistance(),n=this.kinetic.getAngle(),o=i*Math.cos(n),s=i*Math.sin(n);this.animate&&this._pano.animation.remove(this.animate),this.animate=this._pano.animation.add(this.kinetic.pan([t.heading,t.pitch],[t.heading+o,t.pitch+s]))}else this._pano.trigger("move").trigger("pov_changed",t),this._pano.render(!0)}}),o}),P.module("P.interaction.Keyboard",["P.interaction.Interaction","P.base.events","P.base.dom"],function(t,e,i){function n(t){t=t||{},this._pano=pano,this._panOffset=t.keyboardPanOffset||1,this._zoomOffset=t.keyboardZoomOffset||.1,this._setOffset()}var o={LEFT:[37],RIGHT:[39],DOWN:[40],UP:[38],ZOOMIN:[107],ZOOMOUT:[109]};return P.inherit(n,t,{"static":{KEYCODES:{LEFT:[37],RIGHT:[39],DOWN:[40],UP:[38],ZOOMIN:[107],ZOOMOUT:[109]}},_panOffset:5,_zoomOffset:.05,activate:function(){i.on(document,"keydown",this._onKeyDown,this)},deactivate:function(){i.un(document,"keydown",this._onKeyDown,this)},_setOffset:function(){var t,e={},i={},n=o,s=this._panOffset,r=this._zoomOffset;for(t=n.LEFT.length;t--;)e[n.LEFT[t]]={heading:0-s,pitch:0};for(t=n.RIGHT.length;t--;)e[n.RIGHT[t]]={heading:s,pitch:0};for(t=n.UP.length;t--;)e[n.UP[t]]={heading:0,pitch:0-s};for(t=n.DOWN.length;t--;)e[n.DOWN[t]]={heading:0,pitch:s};for(t=n.ZOOMIN.length;t--;)i[n.ZOOMIN[t]]=r;for(t=n.ZOOMOUT.length;t--;)i[n.ZOOMOUT[t]]=0-r;this.act_pan=e,this.act_zoom=i},_onKeyDown:function(t){var e=t.keyCode,i=this._pano;e in this.act_pan&&i.setPov(this.act_pan[e],!0),e in this.act_zoom&&i.setZoom(this.act_zoom[e],!0)}}),n}),P.module("P.interaction.PinchZoom",["P.interaction.Interaction","P.base.events","P.base.dom","P.core.geom.Point"],function(t,e,i,n){function o(e){t.call(this,e)}return P.inherit(o,t,{CLASS_NAME:"P.interaction.PinchZoom",_onactive:!1,_zoomed:!1,activate:function(){P.on(this._pano._dragMask,"touchstart",this._onTouchStart,this)},deactivate:function(){P.un(this._pano._dragMask,"touchstart",this._onTouchStart)},_onTouchStart:function(t){this._pano;if(t.touches&&t.touches.length<2)return void(this._onactive=!1);this._onactive=!0;var e=new n(t.touches[0].clientX,t.touches[0].clientY),o=new n(t.touches[1].clientX,t.touches[1].clientY);this._startCenter=e.interpolate(o,.5),this._lookat=this._startCenter,this._tick=Math.min(this._pano.viewWidth,this._pano.viewHeight),this._startDist=e.distanceTo(o)+this._tick,this._oriZoom=this._pano.getZoom(),P.on(this._pano._dragMask,"touchmove",this._onTouchMove,this).on(this._pano._dragMask,"touchend",this._onTouchEnd,this),i.event.preventDefault(t)},_onTouchMove:function(t){if(t.touches&&t.touches.length<2)return void(this._onactive=!1);var e=this._pano;if(0!=this._onactive){var o=new n(t.touches[0].clientX,t.touches[0].clientY),s=new n(t.touches[1].clientX,t.touches[1].clientY);this._scale=(o.distanceTo(s)+this._tick)/this._startDist,0==this._zoomed&&(i.addClass(e._viewport,"pano-touching"),e.trigger("zoomstart"),this._zoomed=!0),e.setZoom(this._oriZoom*(1/this._scale),!1,!1,this._lookat),i.event.preventDefault(t)}},_onTouchEnd:function(){this._pano;this._onactive=!1,this._zoomed=!1,i.removeClass(_pano._viewport,"pano-touching")},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o}),P.module("P.interaction.WheelZoom",["P.interaction.Interaction","P.base.events","P.base.dom","P.anim.Anim"],function(t,e,i,n){function o(e){t.call(this,e)}return P.inherit(o,t,{lookat:null,tick:!1,count:1,activate:function(){i.on(this._pano._dragMask,"mousewheel",this._onMouseWheel,this)},deactivate:function(){i.un(this._pano._dragMask,"mousewheel",this._onMouseWheel)},_doZoom:function(){},_onMouseWheel:function(t){var e=i.event.getWheelDelta(t),o=.004*e,s={x:t.clientX,y:t.clientY};n.loop({duration:300,onUpdate:P.bind(this._pano.setZoom,this._pano,o,!0,!1,s),onComplete:P.bind(this._pano.render,this._pano)}),i.event.preventDefault(t),i.event.stopPropagation(t)}}),o}),P.module("P.render.CssRender",[],function(){function t(t){this._pano=t,this.prefix=P.prefix.css+"transform"}return t.prototype={arc:0,_focus:200,calcPitch:0,options:{},_invalidate:function(){var t=this._pano._scene._tiles,e=this.prefix;this._focus=this._pano._camera._focus;for(var i in t)t[i].obj.style[e]=this.getTransform(t[i].transform)},render:function(){this._invalidate()},getTransform:function(t){var e=(this._pano._scene.size,this._pano.getViewWidth()),i=this._pano.getViewHeight(),n=this._focus;return"translate3d("+e/2+"px, "+i/2+"px, 0px) translateY("+this.arc+"px) perspective("+n+"px) rotateZ(0deg) translateZ("+(n+1e-10)+"px) rotateX("+this.calcPitch+"deg) rotateY("+this._pano.heading+"deg) "+t},setMode:function(t){this.mode=t,this._update()},_update:function(){if("architectural"==this.mode){var t=Math.abs(this._pano.pitch/90),e=this._pano.pitch<0?1:-1;this.calcPitch=t*t*90*e,this.arc=2*t*(1-t)*this._pano.focus*1.22222*e}else this.calcPitch=-this._pano.pitch,this.arc=0}},t}),P.module("P.render.WebGLRender",[],function(){function t(t){this.view=t}return t.prototype={_indraw:!1,render:function(){void 0!=webgl.gl&&this.multiresDraw()},_update:function(){},multiresDraw:function(){var t=this.view._scene;webgl.set({u_persp:this.view._camera.getProjectionMatrix(),u_view:this.view._camera.getViewMatrix()});var e=t._tiles;if(!this._indraw){this._indraw=!0;for(var i in e)webgl.set({a_vp:t.data.vertBuffer.data(e[i].vertices),a_tp:t.data.texBuffer}).bindTexture(e[i].texture).draw(t.data.indexBuffer);this._indraw=!1}}},t}),P.module("P.render.BasicRender",[],function(){function t(t){this._pano=t,this.prefix=P.prefix.css}return t.prototype={_nextFrame:!1,render:function(){1!=this._nextFrame&&(this._nextFrame=!0,P.requestAnimationFrame(P.bind(this._invalidate,this)))},_update:function(){},_invalidate:function(){var t=this._pano._scene._tiles,e=this._pano._scene.tilesize,i=(this._pano._camera._focus,this._pano.getViewHeight(),.5*this._pano.viewWidth),n=.5*this._pano.viewHeight,o=this._pano._camera._focus/this._pano._scene.tilesize,s=e*o,r=(this._pano.getDeep(),4*e*o*this._pano.getHeading(!1)/360),a=1*e*o*this._pano.getPitch()/90,h=Math.floor(this._pano.getHeading(!1)/360),c=this._pano.getHeading(!1)/360%1,u=0>h?c>-.5&&.5>c:c>.5;this._pano._viewport.style.left=Math.floor(i-r)+"px",this._pano._viewport.style.top=Math.floor(n-.5*s-a)+"px";for(var l in t){var p,d,f=t[l];if(f.z<0){var _=o*e;t[l].obj.style.top=f.y*_+"px",t[l].obj.width=4*Math.ceil(_),t[l].obj.height=Math.ceil(_),u?(0==f.x&&(t[l].obj.style.left=h*_*4+"px"),-1==f.x&&(t[l].obj.style.left=(h+1)*_*4+"px")):(0==f.x&&(t[l].obj.style.left=(h-1)*_*4+"px"),-1==f.x&&(t[l].obj.style.left=h*_*4+"px"))}else d=o/(1<<f.z),p=e*d,t[l].obj.style.top=Math.floor(f.y*p)+"px",t[l].obj.style.left=Math.floor(f.x*p)+"px",t[l].obj.width=t[l].obj.height=Math.ceil(p)}this._nextFrame=!1}},t}),P.module("P.overlays.LabelLayer",["P.core.geom.spherical"],function(t){function e(t){this._pano=t,this._list={},this.init()}return e.prototype={init:function(){this._el=P.creat("div",null,"pano-layers-label",this._pano._control,"transform: translateZ(1000000000000px); z-index: 2002; position: absolute; left: 0px; top: 0px; ")},_calcCoord:function(e){var i=e.options.position;if(e.options.local)return{y:i.lat,x:i.lng};var n=t.computeHeading(this._pano.getLocation().latLng,i)+(360-this._pano._panoData.tiles.centerHeading),o=t.computeDistance(this._pano.getLocation().latLng,i),s=0-180*Math.atan(e.getAltitude()/o)/Math.PI;return e.setDistance(o),{y:s,x:n}},_calcDist:function(e){return e.options.local?e.options.distance:t.computeDistance(this._pano.getLocation().latLng,e.options.position)},draw:function(t){if(t)this._drawItem(t._id);else for(var e in this._list)this._drawItem(e)},_drawItem:function(t){var e=this._list[t],i=this._pano._camera._projectSphere(e.sphereCoord);i?e.obj.setVisible(!0)._moveTo(i):e.obj.setVisible(!1)},update:function(t){this._list[t._id].sphereCoord=this._calcCoord(t),this.draw(t)},add:function(t){console.log("add:"),console.log(t),this._el.appendChild(t._el),this._list[t._id]={obj:t,sphereCoord:this._calcCoord(t),dist:this._calcDist(t)},this.draw(t)},remove:function(t){var e=t.obj._id;this._el.removeChild(t.obj._el),delete this._list[e]},clear:function(){for(var t in this._list)this.remove(this._list[t])}},e}),P.module("P.core.Pano",["P.core.Camera","P.anim.Timeline","P.base.events","P.base.utils","P.base.http","P.base.dom","P.base.feature","P.base.code","P.base.services","P.interaction.Drag","P.interaction.Keyboard","P.interaction.PinchZoom","P.interaction.WheelZoom"],function(t,e,i,n,o,s,r){function a(t,i){if(this.options=P.setOptions(this,i),0==this._check())return void this._error();this._initScene(t),this._regListener();for(var n in d)(this.options[n]||!this.options[n]&&d[n])&&this.addInteraction(n,new(P.require("P.interaction."+n)));this.options.provider&&this.addProvider(this.options.provider),0==this.options.scrollwheel&&this.interactions.WheelZoom.deactivate(),1==this.options.addressControl&&this.addControl(new P.control.AddressControl),this.animation=new e(this)}var h=P.require("P.render.CssRender"),c=P.require("P.render.WebGLRender"),u=P.require("P.render.BasicRender"),l=P.require("P.overlays.LabelLayer"),p=P.require("P.core.object.Cube"),d={PinchZoom:r.touch&&!r.android23,Drag:!0,WheelZoom:!r.touch,Keyboard:!r.touch};return a.prototype={heading:0,pitch:0,zoom:.8,focus:227,fov:120,viewWidth:1,viewHeight:1,minfov:1,maxfov:135,maxPitch:89.99,minPitch:-89.99,_maxpixelzoom:1,options:{_server:"",provider:null,disableDefaultUI:!1,addressControl:!1,imageDateControl:!1,zoomControl:!1,scrollwheel:!0,controlMode:1,_renderPreview:!0},_render:null,_scene:null,_camera:null,_provider:null,_maxZoom:1,_minZoom:.5,_maxDeep:0,_panoData:null,_panoLink:null,_panoPoi:null,_panoid:null,_labelLayer:null,interactions:{},controls:[],animation:null,_frameState:{time:P.now(),pan:[0,0],zoom:.8,process:{pan:!1,zoom:!1,bounce:!1},animate:!1},_visiable:!0,fns:{},get:function(t){return this.fns[t]?this.fns[t].apply(this.fns[t],Array.prototype.slice.call(arguments,1)):void 0},set:function(t,e){return this.fns[t]=e,this},setMode:function(){},panTo:function(t,e){this._camera._unprojectSphere({x:t,y:e})},getVisible:function(){return this._visiable},setVisible:function(t){return this._visiable=t,this._container.style.display=t?"inline":" none",this},getLocation:function(){return this._panoData.location},getPosition:function(){return this._panoData.location.latLng},getLinks:function(){return this._panoLink},setLinks:function(t){this._panoLink=t},setPano:function(t){return this._panoid===t?this:(this._scene&&this._scene.reset(),this._panoid=t,this.options.provider&&(this.options.provider.sync===!1?this.options.provider.getPanoById(t,P.bind(function(e){e&&(this._panoData=e,this._panoLink=this._panoData.link,this.trigger("pano_changed"),this.trigger("link_changed"),this._calcDeep(),this.render()),this.options.provider.getPoiById&&this.options.displayPOI&&this.options.provider.getPoiById(t,P.bind(this._addPoi,this))},this)):(this._panoData=this.options.provider.getPanoById(t),this._panoLink=this._panoData.links,this.trigger("pano_changed"),this.trigger("link_changed"),this.options.provider.getPoiById&&this.options.displayPOI&&this._addPoi(this.options.provider.getPoiById(t)),this._calcDeep(),this.render())),this)},getPano:function(){return this._panoid},_addPoi:function(t){this._labelLayer&&this._labelLayer.clear();for(var e in t)"span"==t[e].type?P.span(t[e]).setPano(this):"icon"==t[e].type?P.icon(t[e]).setPano(this):P.label(t[e]).setPano(this)},_panTo:function(t,e){var i=this._camera._unprojectSphere(e),n=this.getPov();n.heading+=t.x-i.x,n.pitch+=t.y-i.y,this.setPov(n)},setZoom:function(t,e,i,n){void 0===e&&(e=!1),this.zoom=e?this.zoom-t:t,this.zoom=this.zoom>this._maxZoom?this._maxZoom:this.zoom<this._minZoom?this._minZoom:this.zoom;var o=this.maxfov*this.zoom;if("basic"==this.options.render)this.setFov(o);else{var s;n&&(s=this._camera._unprojectSphere(n)),this.setFov(o),n&&void 0!=s&&this._panTo({x:s.x,y:s.y},n)}this.render(i)},getHeading:function(t){return t===!1?this.heading:(this.heading+36e4)%360},getPitch:function(){return this.pitch},setPov:function(t,e,i){void 0===e&&(e=!1),void 0!=t.heading&&(this.heading=e?this.heading+t.heading:t.heading),void 0!=t.pitch&&(this.pitch=e?this.pitch+t.pitch:t.pitch),this.pitch=this.pitch>this.maxPitch?this.maxPitch:this.pitch<this.minPitch?this.minPitch:this.pitch,this._camera.rotate(this.heading,this.pitch),this._render._update(),this.render(i)},setFov:function(t){this.fov=t,this.fov>this.maxfov&&(this.fov=this.maxfov),this.fov<this.minfov&&(this.fov=this.minfov),this._calcFov(),this._camera.update(this.viewWidth,this.viewHeight,this.fov),this._calcDeep(),this._calcPitch(),this.render()},getDeep:function(){return this.deep},_calcFov:function(){var t=this.viewHeight/this.viewWidth;t>.75&&(t=.75),this.minfov=360*Math.atan(this.viewHeight/t/(this._scene.tilesize<<this._maxDeep+this._maxpixelzoom))/Math.PI,this._minDeep&&(this.maxfov=Math.min(this.maxfov,360*Math.atan(this.viewHeight/t/(this._scene.tilesize<<this._minDeep+.01))/Math.PI)),"basic"==this.options.render&&(this.maxfov=360*Math.atan(.5)/Math.PI),this._minZoom=this.minfov/this.maxfov,this.zoom<this._minZoom&&(this.zoom=this._minZoom);var e=this.maxfov*this.zoom;return this.fov!=e?(this.fov=e,!0):!1},_calcPitch:function(){if("basic"==this.options.render){var t=this._camera.getViewportFor2D(this._scene.tilesize),e=90*(.5-t[1]/2);this.maxPitch=e,this.minPitch=-e;var t;this.pitch>this.maxPitch&&(t=this.maxPitch),this.pitch<this.minPitch&&(t=this.minPitch),t!=this.pitch&&this.setPov({pitch:this.pitch})}},_calcDeep:function(){this.deep=Math.round(Math.log(this._camera._focus/this._scene.tilesize)/Math.LN2+1),this.deep>this._maxDeep&&(this.deep=this._maxDeep),this.deep<this._minDeep&&(this.deep=this._minDeep),this.kinetic&&(this.kinetic.deceleration=.002/(this.deep<1?1:this.deep))},_getTileUrl:function(t){return t.panoid=this._panoid,this._panoData.tiles.getTileUrl(t)},getZoom:function(){return this.zoom},getFocus:function(){return this.focus},getPov:function(){return{heading:this.heading,pitch:this.pitch}},getPhotographerPov:function(){return{}},getSize:function(){return new P.geom.Point(this.viewWidth,this.viewHeight)},getViewWidth:function(){return this.viewWidth},getViewHeight:function(){return this.viewHeight},getViewport:function(){return this._camera._vp},_nextFrame:!1,setSize:function(t,e){1!=this._nextFrame&&(this._nextFrame=!0,P.requestAnimationFrame(P.bind(this._invalidateSetSize,this,t,e)))},_invalidateSetSize:function(t,e){this._wrap.style.width=t+"px",this._wrap.style.height=e+"px",this.viewWidth=t,this.viewHeight=e,this._calcFov(),this._camera.update(this.viewWidth,this.viewHeight,this.fov),this._calcPitch(),this._scene.setSize(t,e),this.render(),this._nextFrame=!1},getContainer:function(){return this._container},getViewPortFromPov:function(){},panoToViewport:function(){},addHandler:function(){},addControl:function(t){return this.controls.push(t),console.log(t),t.addTo(this),this},removeControl:function(){},addInteraction:function(t,e){return this.interactions[t]=e,e.addTo(this),this},removeInteraction:function(){},addProvider:function(t){return this._maxDeep=void 0==t.maxDeep?1:t.maxDeep,this._minDeep=void 0==t.minDeep?0:t.minDeep,this._scene.tilesize=t.options.size,this._scene._onceMode=t.options.onceMode||!1,this._scene._ignoneLv0=void 0===t.options.ignoneLv0?!1:t.options.ignoneLv0,this._maxpixelzoom=void 0===t.options.maxpixelzoom?1:t.options.maxpixelzoom,this._renderPreview=this.options._renderPreview,1!=this._renderPreview&&(this._renderPreview=t.options.renderPreview===!0?!0:!1),this._displayPoi=t.options.displayPoi===!0?!0:!1,0==this._maxDeep&&(this._scene._onceMode=!0),r.androidnative&&t._maxDeep>2&&(t._maxDeep=1),"basic"==this.options.render&&(this._scene._onceMode=!1),this.options.provider=t,this.trigger("provider_load"),this.resize(),null!=this._panoid&&this.setPano(this._panoid),this},removeProvider:function(){},_regListener:function(t){t=t||"on";var e,i=["dblclick","click","mousedown","mouseup","mousemove","contextmenu"];for(e=i.length;e--;)P[t](this._container,i[e],this._mouseEvent,this);P.on(window,"resize",this.resize,this)},_mouseEvent:function(t){var e=t.type;"contextmenu"===e&&this._showContextMenu()},_showContextMenu:function(){},_initScene:function(e){var i=document.getElementById(e);if(!i)throw new Error("Pano container not found.");if(i.__pano)throw new Error("Pano container is already initialized.");i.__pano=!0,s.addClass(i,"pano-container"+(r.touch?" pano-touch":"")+(r.retina?" pano-retina":"")+(r.ielt9?" pano-oldie":""));var n=s.css(i,"position");"absolute"!==n&&"relative"!==n&&"fixed"!==n&&(i.style.position="relative"),this._container=i,this._wrap=P.creat("div",null,"pano-wrap",this._container,"position: absolute; overflow: hidden; line-height: normal; font-weight: normal; font-style: normal; outline: 0px; width: 100%; height: 100%; background: #000000;-webkit-user-select: none; -webkit-tap-highlight-color: transparent;"),this._viewport=P.creat("div",null,"pano-viewport",this._wrap,"position: absolute; left: 0px; top: 0px;width:100%;height:100%;overflow: hidden; pointer-events: none;"),this._control=P.creat("div",null,"pano-control",this._wrap,"position: absolute; left: 0px; top: 0px;-webkit-transform-style: preserve-3d;transform-style: preserve-3d;width:100%;height:100%;"),this._dragMask=P.creat("div",null,"pano-dragmask",this._control,"transform: translateZ(1000000000000px);z-index:2001;position: absolute; left: 0px; top:0;width:100%;height:100%;"),this._labelLayer=new l(this),"css"==this.options.render?this._render=new h(this):"webgl"==this.options.render?this._render=new c(this):"basic"==this.options.render&&(this._render=new u(this)),"cube"==this.options.type&&(this._scene=new p(this)),this._camera=new t("basic"==this.options.render?"vfov":"mfov")},_check:function(){return!0},_error:function(){},fullScreen:function(){P.full.isFullScreen()?P.full.cancelFullScreen():P.full.requestFullScreen(this._container)},frameSnapshot:function(){this._frameState.time=P.now(),this._frameState.pan=[this.heading%360,this.pitch],this._frameState.zoom=this.zoom},render:function(t){this._renderTick||(this._renderTick=!0,P.requestAnimationFrame(P.bind(this.invalidateRender,this,t)))},_renderTick:!1,invalidateRender:function(t){this.trigger("renderbefore"),this.frameSnapshot(),t||this._scene._checkTiles(),this._render.render(),this._renderPreview&&this._scene._preview.render(),this._labelLayer.draw(),this.trigger("render"),this._renderTick=!1},resize:function(){P.full.isFullScreen()?s.addClass(this._container,"pano-fullscreen"):s.removeClass(this._container,"pano-fullscreen");var t=P.width(this._container),e=P.height(this._container);this.setSize(t,e)}},P.extend(a.prototype,i),P.pano=function(t){var e={render:"auto",type:"auto",debug:!1,multires:!1},i=t.node;t=P.extend(e,t);var o=(t.render.match(/^!(webgl|css|basic)/)||["",""])[1];o&&(t.render="auto"),"css"!=t.render||r.css3d||"auto"==t.render,"webgl"!=t.render||r.webgl||"auto"==t.render,"auto"==t.render&&(t.render="basic",r.css3d&&"css"!=o&&(t.render="css"),r.webgl&&"webgl"!=o&&(t.render="webgl")),"auto"==t.type&&(t.type="cube");var s=new a(i,t);return e.debug&&n.debug(i,s),s},P.config=P.pano,a}),P.module("P.overlays.Overlay",["P.core.geom.Point","P.core.geom.Latlng"],function(t,e){var i=function(){this.options={position:new e,altitude:0,content:"",visible:!0,pano:null,type:"",local:!1,scale:.8},this._pano=null,this._labelLayer=null,this.pre=P.prefix.css+"transform"};return i.prototype={init:function(){},getPano:function(){return this._pano},getPosition:function(){return this.options.position},getAltitude:function(){return this.options.altitude},setPano:function(t){return null===t?(this._labelLayer&&(this._labelLayer.remove(this),this._labelLayer=null),this._pano&&(this._pano=null),this):(this._pano=t,this._labelLayer=t._labelLayer,this._labelLayer.add(this),this)},setVisible:function(t){return this.options.visible!=t&&(this.options.visible=t,this._el.style.display=t?"block":"none"),this},setPosition:function(t){return this.options.position=t,this._draw(),this},setLocation:function(t){return t.altitude&&(this.options.position=t.position,this.options.altitude=t.altitude,this.options.local=!1),t.distance&&(this.options.position=t.position,this.options.distance=t.distance,this.options.local=!0,this.setDistance(t.distance)),this},setDistance:function(t){var e=(120-t)/120;e=.9*e+.6*(1-e),this.options.scale=e,this._el.style.transform="scale("+e+","+e+")",t>120&&(this._el.style.visibility="hidden")},_draw:function(){this._labelLayer&&this._labelLayer.update(this)},_moveTo:function(t){this._el.style[this.pre]="translateX("+t.x+"px) translateY("+t.y+"px)"}},i}),P.module("P.overlays.Icon",["P.core.geom.Latlng","P.overlays.Overlay","P.base.utils"],function(t,e,i){var n=function(e){this.options={size:[64,128],position:new t,content:"",visible:!0,pano:null,type:"icon",local:!0},P.setOptions(this,e),this._id=i.stamp(this),this.init()};return n.prototype=new e,n.prototype.constructor=n,n.prototype.init=function(){var t=this.options.size[0],e=this.options.size[1];this._el=P.creat("div",null,"pano-overlay-icon",null,"position: absolute; left: 0px; top: 0px;display:block;padding:0px;color:#fff;transform-origin: 50% 50%; "+this.pre+":translate(0px,0px);",{action:this.options.action}),this._contentDiv=P.creat("div",null,"pano-icon-content",this._el,"background:url("+this.options.image+");width:"+t+"px;height:"+e+"px;position:absolute;top:"+-e+"px;left:"+-t/2+"px"),this.options.position&&this.setPosition(this.options.position),this.options.pano&&this.setPano(this.options.pano),this._regListeners()},n.prototype._regListeners=function(){P.on(this._contentDiv,"click",this._onClick,this)},n.prototype._onClick=function(t){var e=P.data(t.target.parentNode||t.srcElement.parentNode,"action")||"";e=e.split(","),"setPano"==e[0]?this._pano.setPano(e[1]):this._pano.get.apply(this._pano,e)},P.icon=function(t){return new P.overlays.Icon(t)},n}),P.module("P.overlays.Label",["P.core.geom.Latlng","P.overlays.Overlay","P.base.utils","P.base.events"],function(t,e,i,n){function o(e){this.options={position:new t,altitude:0,content:"",visible:!0,pano:null,type:"",local:!1,scale:.8},this._pano=null,this._labelLayer=null,this._icon={url:"",size:{w:54,h:54}},this._id=P.stamp(this),this.init(e)}return P.inherit(o,e,{mixin:n,setContent:function(t){this._contentDiv.innerHTML=t;var e=i.getLength(t);return this._el.style.width=this._icon.size.w+e+"px",console.log(this._el.style),this._contentDiv.style.display=t?"block":"none",this._draw(),this},init:function(t){P.setOptions(this,t);var e=""!=this.options.type?" label-"+this.options.type:"";this._el=P.creat("div",null,"pano-overlay-label"+e,null,"position: absolute; left: 0px; top: 0px;display:block;",{action:t.action}),this._iconDiv=P.creat("img",null,null,this._el,""),this._contentDiv=P.creat("span",null,null,this._el,""),""!=this.options.type&&(this._iconDiv.src="assets/icons/"+this.options.type+".png"),this.options.content&&this.setContent(this.options.content),this.options.location&&this.setLocation(this.options.location),this.options.pano&&this.setPano(this.options.pano),this._regListeners()},_regListeners:function(){P.on(this._el,"click",this._onClick,this)},_onClick:function(t){var e=P.data(t.target.parentNode||t.srcElement.parentNode,"action")||"";e=e.split(","),"setPano"==e[0]?this._pano.setPano(e[1]):this._pano.get.apply(this._pano,e)},_draw:function(){this._labelLayer&&this._labelLayer.update(this)}}),P.label=function(t){return new o(t)},o}),P.module("P.overlays.Span",["P.core.geom.Latlng","P.base.utils"],function(t,e){function i(e){this.options={position:new t,content:"",visible:!0,pano:null,type:"",local:!0},this._pano=null,this._labelLayer=null,this._id=P.stamp(this),this.w=60,this.pre=P.prefix.css+"transform",P.extend(this,P.base.events),this.init(e)}return i.prototype={init:function(t){P.setOptions(this,t),this._el=P.creat("div",null,"pano-overlay-span",null,"position: absolute; left: 0px; top: 0px;display:block;padding:3px;color:#fff;transform-origin: 50% 50% 0px; height: 34px; "+this.pre+":translate(0px,0px);",{action:t.action}),this._contentDiv=P.creat("span",null,"pano-span-content",this._el,"background:#000;padding:3px 5px;"),this._arrow=P.creat("span",null,"pano-span-arrow",this._el),""!=this.options.content&&this.setContent(this.options.content),this.options.position&&this.setPosition(this.options.position),this.options.pano&&this.setPano(this.options.pano),this._regListeners()},_regListeners:function(){P.on(this._el,"click",this._onClick,this)},_onClick:function(t){var e=P.data(t.target.parentNode||t.srcElement.parentNode,"action")||"";e=e.split(","),"setPano"==e[0]?this._pano.setPano(e[1]):this._pano.call.apply(this._pano,e)},_draw:function(){this._labelLayer&&this._labelLayer.update(this)},_moveTo:function(t){"translate("+t.x+"px, "+t.y+"px) translate(-px, -17px) rotate(0deg) translate(0px, 0px) scale(1, 1) translate(0px, 0px)";this._el.style[this.pre]="translateZ(0px) translate("+t.x+"px, "+t.y+"px) translate(-"+this.w/2+"px, -20px) rotate(0deg) translate(0px, 0px) scale(1,1) translate(0px, 0px)"},setPano:function(t){return null===t?(this._labelLayer&&(this._labelLayer.remove(this),this._labelLayer=null),this._pano&&(this._pano=null),this):(this._pano=t,this._labelLayer=t._labelLayer,this._labelLayer.add(this),this)},_reset:function(){},setPosition:function(t){return this.options.position=t,this._draw(),this},setContent:function(t){return this._contentDiv.innerHTML=this.options._content=t,this.w=e.getLength(t),this._contentDiv.style.width=this.w+"px",this._contentDiv.style.display=""==t?"none":"block",this._draw(),this},setVisible:function(t){return this.options.visible!=t&&(this.options.visible=t,this._el.style.display=t?"block":"none"),this}},P.span=function(t){return new i(t)},i}),P.module("P.provider.BasicProvider",["P.base.feature","P.base.utils"],function(t,e){function i(e){this.options={render:"auto",multires:!0,fov:120,url:"",getTile:null,size:512,onceMode:!1,faceurl:!1,sync:!0},this.ready=!1,this.data={},P.setOptions(this,e),this.maxDeep=t.mobile&&this.options.maxDeep>1?1:this.options.maxDeep,this.maxZoom=1<<this.maxDeep,this.onceMode=this.options.onceMode||t.mobile&&this.maxDeep<=1}return i.prototype={_creatTileData:function(t){return{location:{latLng:{lat:0,lng:0},description:"",pano:t},imageDate:"",copyright:"",links:[],tiles:{worldSize:null,tileSize:this.options.size,centerHeading:0,getTileUrl:P.bind(this.getTile,this)}}},getPanoById:function(t){return this.data[t]?this.data[t].panoData:this._creatTileData(t)},getPanoByLocation:function(){return{}},getPoiById:function(t){return this.data[t]?this.data[t].poiData:[]},getTile:function(t){if("function"==typeof this.options.getTile)return this.options.getTile(t);if("preview"==t||"-1"==t.z)return this.options.preview;if(0==this.options.faceurl){var i={f:0,r:1,b:2,l:3,u:4,d:5};t.x+=i[t.f]*(1<<t.z)}return console.log(t),e.template(this.options.url,t)}},i}),P.module("P.provider.LocalProvider",["P.base.feature"],function(){function t(t){this.options={render:"auto",multires:!0,type:"cube",server:"",server_pois:"",size:256,fov:120,maxDeep:3,maxpixelzoom:1},this.sync=!0,P.setOptions(this,t),this.options.server+="{panoid}/",this.options.tiles_tpl=this.options.server+"tiles/cube/",this.maxDeep=P.feature.mobile?1:this.options.maxDeep,this.maxZoom=1<<this.maxDeep}return t.prototype={_parse:function(t){return code.decode(t)},getPanoById:function(t){var e=this._parse(t);return{location:{latLng:{lat:e.lat,lng:e.lng},description:"",pano:t},copyright:"HQT",imageDate:e.time,links:[],tiles:{worldSize:null,tileSize:256,centerHeading:e.dir,getTileUrl:P.bind(this.getTile,this)}}},getPanoByLocation:function(){return{}},getThumbById:function(t){return P.utils.template(this.options.server,{panoid:t})+"thumb.jpg"},getTile:function(t){if(-1==t.z)return P.utils.template(this.options.tiles_tpl,t)+"preview.jpg";var e={f:0,r:1,b:2,l:3,u:4,d:5};return t.x+=e[t.f]*(1<<t.z),P.utils.template(this.options.tiles_tpl+"{z}/{x},{y}.jpg",t)}},t}),P.module("P.provider.LocalProvider",["P.base.feature","P.base.code"],function(t,e){function i(e){P.setOptions(this,e),this.options={render:"auto",multires:!0,fov:120,tiles_tpl:"",getTile:null,size:256,onceMode:!1,faceurl:!1,maxpixelzoom:1,ignoneLv0:!1},this.ready=!1,this.data={},P.setOptions(this,e),this.maxDeep=t.mobile&&this.options.maxDeep>1?1:this.options.maxDeep,this.maxZoom=1<<this.maxDeep,this.onceMode=this.options.onceMode||t.mobile&&this.maxDeep<=1,this.renderPreview=this.options.renderPreview===!0?!0:!1,this.options.data&&this.localParse(this.options.data)
}return i.prototype={localParse:function(t){for(var e,i,n={},o=t.owner,s=0;s<t.scene.length;s++){i=t.scene[s].pano;for(var r=0;r<i.length;r++)e=i[r].id,n[e]={panoData:this.localCreatPanoData(i[r],o),poiData:i[r].pois,raw:i[r]}}this.data=n},localCreatPanoData:function(t,i){var n=t.id,o=t.title,s=t.links,r={};o=o||"",s=s||[],i=i||"";var a=function(){return""};return 27==n.length?(a=P.provider.ResProvider.HQT.getTile,r=e.decode(n)):23==n.length?(a=P.provider.ResProvider.QQ.getTile,r.lat=void 0!==t.lat?t.lat:0,r.lng=void 0!==t.lng?t.lng:0,r.time="20"+n.substring(8,10)+"-"+n.substring(10,12),r.dir=void 0!==t.dir?t.dir:0):(a=P.provider.ResProvider.COMMON.getTile,r.lat=0,r.lng=0,r.time="1970-01-01",r.dir=0),{location:{latLng:{lat:r.lat,lng:r.lng},description:o,pano:n},imageDate:r.time,copyright:i,links:s,tiles:{worldSize:null,tileSize:this.options.size,centerHeading:r.dir,getTileUrl:a}}},getPanoById:function(t){return this.data[t]?this.data[t].panoData:this.localCreatPanoData(t)},getPanoByLocation:function(){return{}},getPoiById:function(t){return this.data[t]?this.data[t].poiData:[]},getThumbById:function(t){return 27==t.length?P.provider.ResProvider.HQT.getThumb(t):23==t.length?P.provider.ResProvider.QQ.getThumb(t):P.provider.ResProvider.COMMON.getThumb(t)}},i}),P.module("P.provider.Provider",["P.base.utils"],function(t){function e(){}return e.prototype={sync:!0,getPanoById:function(){},getPanoByLocation:function(){},getPoiById:function(){},getThumbById:function(){}},P.provider.ResProvider={COMMON:{getTile:function(e){var i="pano/{panoid}/",n=i+"tiles/cube/";if(-1==e.z)return t.template(n,e)+"preview.jpg";var o={f:0,r:1,b:2,l:3,u:4,d:5};return e.x+=o[e.f]*(1<<e.z),t.template(n+"{z}/{x},{y}.jpg",e)},getThumb:function(e){var i="pano/{panoid}/";return t.template(i,{panoid:e})+"thumb.jpg"}},HQT:{getTile:function(e){var i="pano/{panoid}/",n=i+"tiles/cube/";if(-1==e.z)return t.template(n,e)+"preview.jpg";var o={f:0,r:1,b:2,l:3,u:4,d:5};return e.x+=o[e.f]*(1<<e.z),t.template(n+"{z}/{x},{y}.jpg",e)},getThumb:function(e){var i="pano/{panoid}/";return t.template(i,{panoid:e})+"thumb.jpg"}},QQ:{getTile:function(e){{var i="http://sv{r7}.map.qq.com/tile?svid={panoid}&x={x}&y={y}&level={z}&mtype=mobile-cube&from=web",n="http://sv0.map.qq.com/thumb?svid={panoid}&x=0&y=0&level=0&mtype=mobile-cube";"http://sv.map.soso.com/poi3d?x={lng}&y={lat}&source=qq&type=street&output=jsonp&cb=?&token="+(new Date).getTime()}if("-1"==e.z&&console.log(e),-1==e.z)return t.template(n,e);var o=e.z;e.z=e.z-1;var s=1<<o,r=(e.z,{f:0,r:1,b:2,l:3,u:4,d:5});return e.x=r[e.f]*s+e.x,e.r7=r[e.f],delete e.f,t.template(i,e)},getThumb:function(t){return"http://capture.map.qq.com/screenshot?model=web&from=qqmap&zoom=0&fov=60&width=188&height=106&pano="+t+"&pitch=0&heading=0"}}},e}),P.module("P.provider.QQProvider",["P.provider.Provider","P.base.feature"],function(t){function e(e){P.setOptions(this,e),this.maxDeep=t.mobile?1:this.options.maxDeep,this.minDeep=1,this.maxZoom=1<<this.maxDeep,this.key=this.options.key,this.multires=!0,void 0==this.key&&alert("QQProvider 需要提供开发者密钥！否则部分功能将失效.")}return e.prototype={options:{render:"auto",multires:!0,type:"cube",server:"",server_pois:"",size:256,fov:120,maxDeep:2,maxpixelzoom:1,ignoneLv0:!0},sync:!1,cfgpath:"http://sv.map.qq.com/sv?pf=html5&svid={panoid}&ch=&output=jsonp&cb=?&token="+(new Date).getTime(),_tpl:"http://sv{r7}.map.qq.com/tile?svid={panoid}&x={x}&y={y}&level={z}&mtype=mobile-cube&from=web",_pre:"http://sv0.map.qq.com/thumb?svid={panoid}&x=0&y=0&level=0&mtype=mobile-cube",_poi:"http://sv.map.soso.com/poi3d?x={lng}&y={lat}&source=qq&type=street&output=jsonp&cb=?&token="+(new Date).getTime(),_parse:function(t,e){{var i=parseInt(e.detail.basic.dir),n={lat:e.detail.addr.y_lat,lng:e.detail.addr.x_lng},o=e.detail.basic.svid;e.detail.basic.source}this._curpos=n,this.scene=e.detail.all_scenes,t({location:{latLng:n,description:"",pano:o},copyright:"Tencent",imageDate:"20"+o.substring(8,10)+"-"+o.substring(10,12),links:[],tiles:{worldSize:null,tileSize:256,centerHeading:i,getTileUrl:P.bind(P.provider.ResProvider.QQ.getTile,this)}})},_cates:{"房产小区":"building","娱乐休闲":"leisure","美食":"food","购物":"shopping","生活服务":"service","医疗保健":"aid","酒店宾馆":"hotel","教育学校":"building","旅游景点":"building","文化广场":"building","停车场":"parking","汽车":"","银行金融":"bank","电影院":"","机构团体":""},_parseType:function(t){return this._cates[t]},_parsePoi:function(t,e){e=e.detail.pois;for(var i=[],n=0;n<e.length;n++)i[n]={position:P.projection.EPSG3785To4326({lat:e[n].y,lng:e[n].x}),content:e[n].name,altitude:e[n].h,id:e[n].uid,type:this._parseType(e[n].catalog)};t(i)},getPanoById:function(t,e){P.jsonp(this.cfgpath.replace("{panoid}",t),P.bind(this._parse,this,e))},getPanoByLocation:function(){return{}},getPoiById:function(t,e){var i=P.projection.EPSG4326To3785(this._curpos);P.jsonp(P.utils.template(this._poi,i),P.bind(this._parsePoi,this,e))},getThumbById:function(t){return"http://capture.map.qq.com/screenshot?model=web&from=qqmap&zoom=0&fov=60&width=188&height=106&pano="+t+"&pitch=0&heading=0"},getTile:function(){}},e});